<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Wishbone" href="wishbone.html" /><link rel="prev" title="Amaranth System on Chip toolkit" href="../amaranth-soc.html" />

    <link rel="shortcut icon" href="../_static/favicon.png"/><!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Memory maps - ChipFlow alpha documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/platformpicker.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">ChipFlow alpha documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">
<a class="sidebar-brand" href="https://chipflow.io/">
    
    
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../amaranth.html">Amaranth Language and Toolchain</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Amaranth Language and Toolchain</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../amaranth/intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../amaranth/install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../amaranth/start.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../amaranth/tutorial.html">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../amaranth/guide.html">Language guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../amaranth/reference.html">Language reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../amaranth/simulator.html">Simulator</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../amaranth/platform.html">Platform integration</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Platform integration</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/platform/altera.html">Altera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/platform/gowin.html">Gowin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/platform/lattice.html">Lattice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/platform/quicklogic.html">Quicklogic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/platform/siliconblue.html">SiliconBlue</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/platform/xilinx.html">Xilinx</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../amaranth/stdlib.html">Standard library</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Standard library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/stdlib/enum.html">Enumerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/stdlib/data.html">Data structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/stdlib/wiring.html">Interfaces and connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/stdlib/meta.html">Interface metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/stdlib/stream.html">Data streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/stdlib/memory.html">Memory arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/stdlib/io.html">Input/output buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/stdlib/cdc.html">Clock domain crossing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/stdlib/coding.html">Code conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth/stdlib/fifo.html">First-in first-out queues</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../amaranth/stdlib/crc.html">Cyclic redundancy checks</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Cyclic redundancy checks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../amaranth/stdlib/crc/catalog.html">Algorithm catalog</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../amaranth/changes.html">Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../amaranth/contrib.html">Contributing</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../amaranth-soc.html">Amaranth System on Chip toolkit</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Amaranth System on Chip toolkit</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Memory maps</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="wishbone.html">Wishbone</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Wishbone</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="wishbone/bus.html">Wishbone bus</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="csr.html">CSR</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of CSR</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="csr/bus.html">CSR bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="csr/reg.html">CSR registers</a></li>
<li class="toctree-l3"><a class="reference internal" href="csr/action.html">CSR fields</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gpio.html">GPIO</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chipflow-lib/index.html">ChipFlow Library Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of ChipFlow Library Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/chipflow-toml-guide.html">Intro to <code class="docutils literal notranslate"><span class="pre">chipflow.toml</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/chipflow-toml-guide.html#silicon-pads">silicon.pads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/chipflow-toml-guide.html#silicon-power">silicon.power</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial-intro-chipflow-platform.html">Introduction to the ChipFlow platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/amaranth-soc/memory.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="module-amaranth_soc.memory">
<span id="memory-maps"></span><h1>Memory maps<a class="headerlink" href="#module-amaranth_soc.memory" title="Link to this heading"></a></h1>
<p>The <a class="reference internal" href="#module-amaranth_soc.memory" title="amaranth_soc.memory"><code class="xref py py-mod docutils literal notranslate"><span class="pre">amaranth_soc.memory</span></code></a> module provides primitives for organizing the address space of a bus interface.</p>
<section id="introduction">
<span id="memory-introduction"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>The purpose of <a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a> is to provide a hierarchical description of the address space of a System-on-Chip, from its bus interconnect to the registers of its peripherals. It is composed of <a class="reference internal" href="#memory-resources"><span class="std std-ref">resources</span></a> (representing registers, memories, etc) and <a class="reference internal" href="#memory-windows"><span class="std std-ref">windows</span></a> (representing bus bridges), and may be <a class="reference internal" href="#memory-accessing-windows"><span class="std std-ref">queried</span></a> afterwards in order to enumerate its contents, or determine the address of a resource.</p>
</section>
<section id="resources">
<span id="memory-resources"></span><h2>Resources<a class="headerlink" href="#resources" title="Link to this heading"></a></h2>
<p>A <em>resource</em> is a <a class="reference internal" href="../amaranth/stdlib/wiring.html#amaranth.lib.wiring.Component" title="amaranth.lib.wiring.Component"><code class="xref py py-class docutils literal notranslate"><span class="pre">Component</span></code></a> previously added to a <a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a>. Each resource occupies an unique range of addresses within the memory map, and represents a device that is a target for bus transactions.</p>
<section id="adding-resources">
<h3>Adding resources<a class="headerlink" href="#adding-resources" title="Link to this heading"></a></h3>
<p>Resources are added with <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_resource" title="amaranth_soc.memory.MemoryMap.add_resource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_resource()</span></code></a>, which returns a <code class="docutils literal notranslate"><span class="pre">(start,</span> <span class="pre">end)</span></code> tuple describing their address range:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">memory_map</span> <span class="o">=</span> <span class="n">MemoryMap</span><span class="p">(</span><span class="n">addr_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">reg_ctrl</span> <span class="o">=</span> <span class="n">csr</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">RW</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="s2">&quot;rw&quot;</span><span class="p">)</span>
<span class="n">reg_data</span> <span class="o">=</span> <span class="n">csr</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">RW</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="s2">&quot;rw&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">reg_ctrl</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">addr</span><span class="o">=</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;ctrl&quot;</span><span class="p">,))</span>
<span class="go">(0, 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">reg_data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">addr</span><span class="o">=</span><span class="mh">0x4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,))</span>
<span class="go">(4, 8)</span>
</pre></div>
</div>
<div class="admonition note" id="memory-implicit-next-address">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">addr</span></code> parameter of <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_resource" title="amaranth_soc.memory.MemoryMap.add_resource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_resource()</span></code></a> and <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_window" title="amaranth_soc.memory.MemoryMap.add_window"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_window()</span></code></a> is optional.</p>
<p>To simplify address assignment, each <a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a> has an <em>implicit next address</em>, starting at 0. If a resource or a window is added without an explicit address, the implicit next address is used. In any case, the implicit next address is set to the address immediately following the newly added resource or window.</p>
</div>
</section>
<section id="accessing-resources">
<h3>Accessing resources<a class="headerlink" href="#accessing-resources" title="Link to this heading"></a></h3>
<p>Memory map resources can be iterated with <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.resources" title="amaranth_soc.memory.MemoryMap.resources"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.resources()</span></code></a>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">resource</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">memory_map</span><span class="o">.</span><span class="n">resources</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;name=</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, start=</span><span class="si">{</span><span class="n">start</span><span class="si">:</span><span class="s2">#x</span><span class="si">}</span><span class="s2">, end=</span><span class="si">{</span><span class="n">end</span><span class="si">:</span><span class="s2">#x</span><span class="si">}</span><span class="s2">, resource=</span><span class="si">{</span><span class="n">resource</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">name=Name(&#39;ctrl&#39;), start=0x0, end=0x4, resource=&lt;...&gt;</span>
<span class="go">name=Name(&#39;data&#39;), start=0x4, end=0x8, resource=&lt;...&gt;</span>
</pre></div>
</div>
<p>A memory map can be queried with <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.find_resource" title="amaranth_soc.memory.MemoryMap.find_resource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.find_resource()</span></code></a> to get the name and address range of a given resource:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">find_resource</span><span class="p">(</span><span class="n">reg_ctrl</span><span class="p">)</span>
<span class="go">ResourceInfo(path=(Name(&#39;ctrl&#39;),), start=0x0, end=0x4, width=8)</span>
</pre></div>
</div>
<p>The resource located at a given address can be retrieved with <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.decode_address" title="amaranth_soc.memory.MemoryMap.decode_address"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.decode_address()</span></code></a>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">decode_address</span><span class="p">(</span><span class="mh">0x4</span><span class="p">)</span> <span class="ow">is</span> <span class="n">reg_data</span>
<span class="go">True</span>
</pre></div>
</div>
</section>
</section>
<section id="alignment">
<span id="memory-alignment"></span><h2>Alignment<a class="headerlink" href="#alignment" title="Link to this heading"></a></h2>
<p>The value of <code class="xref py py-attr docutils literal notranslate"><span class="pre">MemoryMap.alignment</span></code> constrains the layout of a memory map. If unspecified, it defaults to 0.</p>
<p>Each resource or window added to a memory map is placed at an address that is a multiple of <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">**</span> <span class="pre">alignment</span></code>, and its size is rounded up to a multiple of <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">**</span> <span class="pre">alignment</span></code>.</p>
<p>For example, the resources of this memory map are 64-bit aligned:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">memory_map</span> <span class="o">=</span> <span class="n">MemoryMap</span><span class="p">(</span><span class="n">addr_width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">reg_foo</span> <span class="o">=</span> <span class="n">csr</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">RW</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="s2">&quot;rw&quot;</span><span class="p">)</span>
<span class="n">reg_bar</span> <span class="o">=</span> <span class="n">csr</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">RW</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="s2">&quot;rw&quot;</span><span class="p">)</span>
<span class="n">reg_baz</span> <span class="o">=</span> <span class="n">csr</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">RW</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="s2">&quot;rw&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">reg_foo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,))</span>
<span class="go">(0, 8)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">reg_bar</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,),</span> <span class="n">addr</span><span class="o">=</span><span class="mh">0x9</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Explicitly specified address 0x9 must be a multiple of 0x8 bytes</span>
</pre></div>
</div>
<p><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_resource" title="amaranth_soc.memory.MemoryMap.add_resource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_resource()</span></code></a> takes an optional <code class="docutils literal notranslate"><span class="pre">alignment</span></code> parameter. If a value greater than <code class="xref py py-attr docutils literal notranslate"><span class="pre">MemoryMap.alignment</span></code> is given, it becomes the alignment of this resource:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">reg_bar</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,),</span> <span class="n">alignment</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">(16, 32)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.align_to" title="amaranth_soc.memory.MemoryMap.align_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.align_to()</span></code></a> can be used to align the <a class="reference internal" href="#memory-implicit-next-address"><span class="std std-ref">implicit next address</span></a>. Its alignment is modified if a value greater than <code class="xref py py-attr docutils literal notranslate"><span class="pre">MemoryMap.alignment</span></code> is given.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">align_to</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="go">64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">reg_baz</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;baz&quot;</span><span class="p">,))</span>
<span class="go">(64, 72)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.align_to" title="amaranth_soc.memory.MemoryMap.align_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.align_to()</span></code></a> has no effect on the size of the next resource or window.</p>
</div>
</section>
<section id="windows">
<span id="memory-windows"></span><h2>Windows<a class="headerlink" href="#windows" title="Link to this heading"></a></h2>
<p>A <em>window</em> is a <a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a> nested inside another memory map. Each window occupies an unique range of addresses within the memory map, and represents a bridge to a subordinate bus.</p>
<section id="adding-windows">
<h3>Adding windows<a class="headerlink" href="#adding-windows" title="Link to this heading"></a></h3>
<p>Windows are added with <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_window" title="amaranth_soc.memory.MemoryMap.add_window"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_window()</span></code></a>, which returns a <code class="docutils literal notranslate"><span class="pre">(start,</span> <span class="pre">end,</span> <span class="pre">ratio)</span></code> tuple describing their address range:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reg_ctrl</span>    <span class="o">=</span> <span class="n">csr</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">RW</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="s2">&quot;rw&quot;</span><span class="p">)</span>
<span class="n">reg_rx_data</span> <span class="o">=</span> <span class="n">csr</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">RW</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="s2">&quot;rw&quot;</span><span class="p">)</span>
<span class="n">reg_tx_data</span> <span class="o">=</span> <span class="n">csr</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">RW</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="s2">&quot;rw&quot;</span><span class="p">)</span>

<span class="n">memory_map</span> <span class="o">=</span> <span class="n">MemoryMap</span><span class="p">(</span><span class="n">addr_width</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="n">rx_window</span>  <span class="o">=</span> <span class="n">MemoryMap</span><span class="p">(</span><span class="n">addr_width</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="n">tx_window</span>  <span class="o">=</span> <span class="n">MemoryMap</span><span class="p">(</span><span class="n">addr_width</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">reg_ctrl</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;ctrl&quot;</span><span class="p">,))</span>
<span class="go">(0, 1)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">rx_window</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">reg_rx_data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,))</span>
<span class="go">(0, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_window</span><span class="p">(</span><span class="n">rx_window</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;rx&quot;</span><span class="p">,))</span>
<span class="go">(4096, 8192, 1)</span>
</pre></div>
</div>
<p>The third value returned by <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_window" title="amaranth_soc.memory.MemoryMap.add_window"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_window()</span></code></a> represents the number of addresses that are accessed in the bus described by <code class="docutils literal notranslate"><span class="pre">rx_window</span></code> for one transaction in the bus described by <code class="docutils literal notranslate"><span class="pre">memory_map</span></code>. It is 1 in this case, as both busses have the same width.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tx_window</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">reg_tx_data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,))</span>
<span class="go">(0, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_window</span><span class="p">(</span><span class="n">tx_window</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;tx&quot;</span><span class="p">,))</span>
<span class="go">(8192, 12288, 1)</span>
</pre></div>
</div>
<section id="accessing-windows">
<span id="memory-accessing-windows"></span><h4>Accessing windows<a class="headerlink" href="#accessing-windows" title="Link to this heading"></a></h4>
<p>Memory map windows can be iterated with <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.windows" title="amaranth_soc.memory.MemoryMap.windows"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.windows()</span></code></a>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">window</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">ratio</span><span class="p">)</span> <span class="ow">in</span> <span class="n">memory_map</span><span class="o">.</span><span class="n">windows</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, start=</span><span class="si">{</span><span class="n">start</span><span class="si">:</span><span class="s2">#x</span><span class="si">}</span><span class="s2">, end=</span><span class="si">{</span><span class="n">end</span><span class="si">:</span><span class="s2">#x</span><span class="si">}</span><span class="s2">, ratio=</span><span class="si">{</span><span class="n">ratio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">Name(&#39;rx&#39;), start=0x1000, end=0x2000, ratio=1</span>
<span class="go">Name(&#39;tx&#39;), start=0x2000, end=0x3000, ratio=1</span>
</pre></div>
</div>
<p>Windows can also be iterated with <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.window_patterns" title="amaranth_soc.memory.MemoryMap.window_patterns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.window_patterns()</span></code></a>, which encodes their address ranges as bit patterns compatible with the <a class="reference internal" href="../amaranth/guide.html#lang-matchop"><span class="std std-ref">match operator</span></a> and the <a class="reference internal" href="../amaranth/guide.html#lang-switch"><span class="std std-ref">Case block</span></a>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">window</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">ratio</span><span class="p">)</span> <span class="ow">in</span> <span class="n">memory_map</span><span class="o">.</span><span class="n">window_patterns</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, pattern=&#39;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&#39;, ratio=</span><span class="si">{</span><span class="n">ratio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">Name(&#39;rx&#39;), pattern=&#39;01------------&#39;, ratio=1</span>
<span class="go">Name(&#39;tx&#39;), pattern=&#39;10------------&#39;, ratio=1</span>
</pre></div>
</div>
<p>Memory map resources can be recursively iterated with <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.all_resources" title="amaranth_soc.memory.MemoryMap.all_resources"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.all_resources()</span></code></a>, which yields instances of <a class="reference internal" href="#amaranth_soc.memory.ResourceInfo" title="amaranth_soc.memory.ResourceInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceInfo</span></code></a>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">res_info</span> <span class="ow">in</span> <span class="n">memory_map</span><span class="o">.</span><span class="n">all_resources</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">res_info</span><span class="p">)</span>
<span class="go">ResourceInfo(path=(Name(&#39;ctrl&#39;),), start=0x0, end=0x1, width=32)</span>
<span class="go">ResourceInfo(path=(Name(&#39;rx&#39;), Name(&#39;data&#39;)), start=0x1000, end=0x1001, width=32)</span>
<span class="go">ResourceInfo(path=(Name(&#39;tx&#39;), Name(&#39;data&#39;)), start=0x2000, end=0x2001, width=32)</span>
</pre></div>
</div>
</section>
</section>
<section id="address-translation">
<h3>Address translation<a class="headerlink" href="#address-translation" title="Link to this heading"></a></h3>
<p>When a memory map resource is accessed through a window, address translation may happen in three different modes.</p>
<section id="transparent-mode">
<h4>Transparent mode<a class="headerlink" href="#transparent-mode" title="Link to this heading"></a></h4>
<p>In <em>transparent mode</em>, each transaction on the primary bus results in one transaction on the subordinate bus without loss of data. This mode is selected when <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_window" title="amaranth_soc.memory.MemoryMap.add_window"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_window()</span></code></a> is given <code class="docutils literal notranslate"><span class="pre">sparse=None</span></code>, which will fail if the window and the memory map have a different data widths.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In practice, transparent mode is identical to other modes; it can only be used with equal data widths, which results in the same behavior regardless of the translation mode. However, it causes <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_window" title="amaranth_soc.memory.MemoryMap.add_window"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_window()</span></code></a> to fail if the data widths are different.</p>
</div>
</section>
<section id="sparse-mode">
<h4>Sparse mode<a class="headerlink" href="#sparse-mode" title="Link to this heading"></a></h4>
<p>In <em>sparse mode</em>, each transaction on the wide primary bus results in one transaction on the narrow subordinate bus. High data bits on the primary bus are ignored, and any contiguous resource on the subordinate bus becomes discontiguous on the primary bus. This mode is selected when <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_window" title="amaranth_soc.memory.MemoryMap.add_window"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_window()</span></code></a> is given <code class="docutils literal notranslate"><span class="pre">sparse=True</span></code>.</p>
</section>
<section id="dense-mode">
<h4>Dense mode<a class="headerlink" href="#dense-mode" title="Link to this heading"></a></h4>
<p>In <em>dense mode</em>, each transaction on the wide primary bus results in several transactions on the narrow subordinate bus, and any contiguous resource on the subordinate bus stays contiguous on the primary bus. This mode is selected when <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_window" title="amaranth_soc.memory.MemoryMap.add_window"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_window()</span></code></a> is given <code class="docutils literal notranslate"><span class="pre">sparse=False</span></code>.</p>
</section>
</section>
</section>
<section id="freezing">
<h2>Freezing<a class="headerlink" href="#freezing" title="Link to this heading"></a></h2>
<p>The state of a memory map can become immutable by calling <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.freeze" title="amaranth_soc.memory.MemoryMap.freeze"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.freeze()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">memory_map</span> <span class="o">=</span> <span class="n">MemoryMap</span><span class="p">(</span><span class="n">addr_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">reg_ctrl</span> <span class="o">=</span> <span class="n">csr</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">RW</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="s2">&quot;rw&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">reg_ctrl</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">addr</span><span class="o">=</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;ctrl&quot;</span><span class="p">,))</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Memory map has been frozen. Cannot add resource &lt;...&gt;</span>
</pre></div>
</div>
<p>It is recommended to freeze a memory map before passing it to external logic, as a preventive measure against TOCTTOU bugs.</p>
<dl class="py class">
<dt class="sig sig-object py" id="amaranth_soc.memory.MemoryMap">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth_soc.memory.</span></span><span class="sig-name descname"><span class="pre">MemoryMap</span></span><a class="headerlink" href="#amaranth_soc.memory.MemoryMap" title="Link to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.memory.MemoryMap.freeze">
<span class="sig-name descname"><span class="pre">freeze</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.memory.MemoryMap.freeze" title="Link to this definition"></a></dt>
<dd><p>Freeze the <a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a>.</p>
<p>Once the <a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a> is frozen, its visible state becomes immutable. Resources and
windows cannot be added anymore.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.memory.MemoryMap.align_to">
<span class="sig-name descname"><span class="pre">align_to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alignment</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.memory.MemoryMap.align_to" title="Link to this definition"></a></dt>
<dd><p>Align the <a class="reference internal" href="#memory-implicit-next-address"><span class="std std-ref">implicit next address</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>alignment</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, power-of-2 exponent) – Address alignment. The start of the implicit next address will be a multiple of
<code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">**</span> <span class="pre">max(alignment,</span> <span class="pre">self.alignment)</span></code>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Implicit next address.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.memory.MemoryMap.add_resource">
<span class="sig-name descname"><span class="pre">add_resource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resource</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">addr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alignment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.memory.MemoryMap.add_resource" title="Link to this definition"></a></dt>
<dd><p>Add a resource.</p>
<p>A resource is any device on the bus that is a destination for bus transactions, e.g.
a register or a memory block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resource</strong> (<a class="reference internal" href="../amaranth/stdlib/wiring.html#amaranth.lib.wiring.Component" title="amaranth.lib.wiring.Component"><code class="xref py py-class docutils literal notranslate"><span class="pre">amaranth.lib.wiring.Component</span></code></a>) – The resource to be added.</p></li>
<li><p><strong>name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap.Name</span></code>) – Name of the resource. It must not conflict with the name of other resources or windows
present in this memory map.</p></li>
<li><p><strong>addr</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Address of the resource. Optional. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, the <a class="reference internal" href="#memory-implicit-next-address"><span class="std std-ref">implicit next address</span></a> will be used. Otherwise, the exact specified address
(which must be a multiple of <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">**</span> <span class="pre">max(alignment,</span> <span class="pre">self.alignment)</span></code>) will be used.</p></li>
<li><p><strong>size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Size of the resource, in minimal addressable units. Rounded up to a multiple of
<code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">**</span> <span class="pre">max(alignment,</span> <span class="pre">self.alignment)</span></code>.</p></li>
<li><p><strong>alignment</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, power-of-2 exponent) – Alignment of the resource. Optional. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, the memory map alignment is used.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple <code class="docutils literal notranslate"><span class="pre">(start,</span> <span class="pre">end)</span></code> describing the address range assigned to the resource.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If the memory map is frozen.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If the requested address and size, after alignment, would overlap with any resources or
    windows that have already been added, or would be out of bounds.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If <code class="docutils literal notranslate"><span class="pre">resource</span></code> has already been added to this memory map.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If the requested name would conflict with the name of other resources or windows that
    have already been added.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.memory.MemoryMap.resources">
<span class="sig-name descname"><span class="pre">resources</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.memory.MemoryMap.resources" title="Link to this definition"></a></dt>
<dd><p>Iterate local resources and their address ranges.</p>
<p>Non-recursively iterate resources in ascending order of their address.</p>
<dl class="field-list simple">
<dt class="field-odd">Yields<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of (<a class="reference internal" href="../amaranth/stdlib/wiring.html#amaranth.lib.wiring.Component" title="amaranth.lib.wiring.Component"><code class="xref py py-class docutils literal notranslate"><span class="pre">amaranth.lib.wiring.Component</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap.Name</span></code>,         <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)) – A tuple <code class="docutils literal notranslate"><span class="pre">resource,</span> <span class="pre">name,</span> <span class="pre">(start,</span> <span class="pre">end)</span></code> describing the address range assigned to the
resource.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.memory.MemoryMap.add_window">
<span class="sig-name descname"><span class="pre">add_window</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">window</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">addr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sparse</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.memory.MemoryMap.add_window" title="Link to this definition"></a></dt>
<dd><p>Add a window.</p>
<p>A window is a device on a bus that provides access to a different bus, i.e. a bus bridge.
It performs address translation, such that the devices on a subordinate bus have different
addresses; the memory map reflects this address translation when resources are looked up
through the window.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>window</strong> (<a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a>) – A <a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a> describing the layout of the window. It is frozen as a side-effect
of being added to this memory map.</p></li>
<li><p><strong>name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap.Name</span></code>) – Name of the window. Optional. It must not conflict with the name of other resources or
windows present in this memory map.</p></li>
<li><p><strong>addr</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Address of the window. Optional. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, the <a class="reference internal" href="#memory-implicit-next-address"><span class="std std-ref">implicit next address</span></a> will be used after aligning it to
<code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">**</span> <span class="pre">window.addr_width</span></code>. Otherwise, the exact specified address (which must be a
multiple of <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">**</span> <span class="pre">window.addr_width</span></code>) will be used.</p></li>
<li><p><strong>sparse</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>) – Address translation type. Optional. Ignored if the datapath widths of both memory maps
are equal; must be specified otherwise.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple <code class="docutils literal notranslate"><span class="pre">(start,</span> <span class="pre">end,</span> <span class="pre">ratio)</span></code> describing the address range assigned to the window.
When bridging buses of unequal data width, <code class="docutils literal notranslate"><span class="pre">ratio</span></code> is the amount of contiguous
addresses on the narrower bus that are accessed for each transaction on the wider bus.
Otherwise, it is always 1.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If the memory map is frozen.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If the requested address and size, after alignment, would overlap with any resources or
    windows that have already been added, or would be out of bounds.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If <code class="docutils literal notranslate"><span class="pre">window.data_width</span></code> is wider than <code class="xref py py-attr docutils literal notranslate"><span class="pre">data_width</span></code>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If the address translation mode is unspecified and <code class="docutils literal notranslate"><span class="pre">window.data_width</span></code> is different
    than <code class="xref py py-attr docutils literal notranslate"><span class="pre">data_width</span></code>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If dense address translation is used and <code class="xref py py-attr docutils literal notranslate"><span class="pre">data_width</span></code> is not an integer multiple
    of <code class="docutils literal notranslate"><span class="pre">window.data_width</span></code>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If dense address translation is used and the ratio of <code class="xref py py-attr docutils literal notranslate"><span class="pre">data_width</span></code> to
    <code class="docutils literal notranslate"><span class="pre">window.data_width</span></code> is not a power of 2.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If dense address translation is used and the ratio of <code class="xref py py-attr docutils literal notranslate"><span class="pre">data_width</span></code> to
    <code class="docutils literal notranslate"><span class="pre">window.data_width</span></code> is lesser than 2 raised to the power of <code class="xref py py-attr docutils literal notranslate"><span class="pre">alignment</span></code>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If the requested name would conflict with the name of other resources or windows that
    have already been added.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If <code class="docutils literal notranslate"><span class="pre">window</span></code> is anonymous and the name of one of its resources or windows would
    conflict with the name of any resources or windows that have already been added.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.memory.MemoryMap.windows">
<span class="sig-name descname"><span class="pre">windows</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.memory.MemoryMap.windows" title="Link to this definition"></a></dt>
<dd><p>Iterate local windows and their address ranges.</p>
<p>Non-recursively iterate windows in ascending order of their address.</p>
<dl class="field-list simple">
<dt class="field-odd">Yields<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of (<a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap.Name</span></code>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of         (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)) – A tuple <code class="docutils literal notranslate"><span class="pre">window,</span> <span class="pre">name,</span> <span class="pre">(start,</span> <span class="pre">end,</span> <span class="pre">ratio)</span></code> describing the address range assigned to
the window. When bridging busses of unequal data widths, <code class="docutils literal notranslate"><span class="pre">ratio</span></code> is the amount of
contiguous addresses on the narrower bus that are accessed for each transaction on the
wider bus. Otherwise, it is always 1.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.memory.MemoryMap.window_patterns">
<span class="sig-name descname"><span class="pre">window_patterns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.memory.MemoryMap.window_patterns" title="Link to this definition"></a></dt>
<dd><p>Iterate local windows and patterns that match their address ranges.</p>
<p>Non-recursively iterate windows in ascending order of their address.</p>
<dl class="field-list simple">
<dt class="field-odd">Yields<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of (<a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap.Name</span></code>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of         (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)) – A tuple <code class="docutils literal notranslate"><span class="pre">window,</span> <span class="pre">name,</span> <span class="pre">(pattern,</span> <span class="pre">ratio)</span></code> describing the address range assigned to the
window. <code class="docutils literal notranslate"><span class="pre">pattern</span></code> is a <code class="xref py py-attr docutils literal notranslate"><span class="pre">addr_width</span></code> wide pattern that may be used in <code class="docutils literal notranslate"><span class="pre">Case</span></code>
or <code class="docutils literal notranslate"><span class="pre">match</span></code> to determine if a value is within the address range of <code class="docutils literal notranslate"><span class="pre">window</span></code>. When
bridging busses of unequal data widths, <code class="docutils literal notranslate"><span class="pre">ratio</span></code> is the amount of contiguous addresses
on the narrower bus that are accessed for each transaction on the wider bus. Otherwise,
it is always 1.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.memory.MemoryMap.all_resources">
<span class="sig-name descname"><span class="pre">all_resources</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.memory.MemoryMap.all_resources" title="Link to this definition"></a></dt>
<dd><p>Iterate all resources and their address ranges.</p>
<p>Recursively iterate all resources in ascending order of their address, performing address
translation for resources that are located behind a window.</p>
<dl class="field-list simple">
<dt class="field-odd">Yields<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth_soc.memory.ResourceInfo" title="amaranth_soc.memory.ResourceInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceInfo</span></code></a> – A description of the resource and its address range.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.memory.MemoryMap.find_resource">
<span class="sig-name descname"><span class="pre">find_resource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resource</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.memory.MemoryMap.find_resource" title="Link to this definition"></a></dt>
<dd><p>Find address range corresponding to a resource.</p>
<p>Recursively find the address range of a resource, performing address translation for
resources that are located behind a window.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>resource</strong> (<a class="reference internal" href="../amaranth/stdlib/wiring.html#amaranth.lib.wiring.Component" title="amaranth.lib.wiring.Component"><code class="xref py py-class docutils literal notranslate"><span class="pre">amaranth.lib.wiring.Component</span></code></a>) – Resource previously added to this <a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a> or one of its windows.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A description of the resource and its address range.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth_soc.memory.ResourceInfo" title="amaranth_soc.memory.ResourceInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceInfo</span></code></a></p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.13)"><strong>KeyError</strong></a> – If the resource is not found.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.memory.MemoryMap.decode_address">
<span class="sig-name descname"><span class="pre">decode_address</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">address</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.memory.MemoryMap.decode_address" title="Link to this definition"></a></dt>
<dd><p>Decode an address to a resource.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>address</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Address of interest.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A resource mapped to the provided address, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if there is no such resource.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="../amaranth/stdlib/wiring.html#amaranth.lib.wiring.Component" title="amaranth.lib.wiring.Component"><code class="xref py py-class docutils literal notranslate"><span class="pre">amaranth.lib.wiring.Component</span></code></a> or <code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="amaranth_soc.memory.ResourceInfo">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth_soc.memory.</span></span><span class="sig-name descname"><span class="pre">ResourceInfo</span></span><a class="headerlink" href="#amaranth_soc.memory.ResourceInfo" title="Link to this definition"></a></dt>
<dd><p>Resource metadata.</p>
<p>A description of a <a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a> resource with its assigned path and address range.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resource</strong> (<a class="reference internal" href="../amaranth/stdlib/wiring.html#amaranth.lib.wiring.Component" title="amaranth.lib.wiring.Component"><code class="xref py py-class docutils literal notranslate"><span class="pre">amaranth.lib.wiring.Component</span></code></a>) – A resource located in the <a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a>. See <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_resource" title="amaranth_soc.memory.MemoryMap.add_resource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_resource()</span></code></a> for
details.</p></li>
<li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of <code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap.Name</span></code>) – Path of the resource. It is composed of the names of each window sitting between
the resource and the <a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a> from which this <a class="reference internal" href="#amaranth_soc.memory.ResourceInfo" title="amaranth_soc.memory.ResourceInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceInfo</span></code></a> was obtained.
See <a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_window" title="amaranth_soc.memory.MemoryMap.add_window"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MemoryMap.add_window()</span></code></a> for details.</p></li>
<li><p><strong>start</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Start of the address range assigned to the resource.</p></li>
<li><p><strong>end</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – End of the address range assigned to the resource.</p></li>
<li><p><strong>width</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Amount of data bits accessed at each address. It may be equal to the data width of the
<a class="reference internal" href="#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a> from which this <a class="reference internal" href="#amaranth_soc.memory.ResourceInfo" title="amaranth_soc.memory.ResourceInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceInfo</span></code></a> was obtained, or less if the
resource is located behind a window that uses sparse addressing.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="wishbone.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Wishbone</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../amaranth-soc.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Amaranth System on Chip toolkit</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, ChipFlow
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Memory maps</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#resources">Resources</a><ul>
<li><a class="reference internal" href="#adding-resources">Adding resources</a></li>
<li><a class="reference internal" href="#accessing-resources">Accessing resources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#alignment">Alignment</a></li>
<li><a class="reference internal" href="#windows">Windows</a><ul>
<li><a class="reference internal" href="#adding-windows">Adding windows</a><ul>
<li><a class="reference internal" href="#accessing-windows">Accessing windows</a></li>
</ul>
</li>
<li><a class="reference internal" href="#address-translation">Address translation</a><ul>
<li><a class="reference internal" href="#transparent-mode">Transparent mode</a></li>
<li><a class="reference internal" href="#sparse-mode">Sparse mode</a></li>
<li><a class="reference internal" href="#dense-mode">Dense mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#freezing">Freezing</a><ul>
<li><a class="reference internal" href="#amaranth_soc.memory.MemoryMap"><code class="docutils literal notranslate"><span class="pre">MemoryMap</span></code></a><ul>
<li><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.freeze"><code class="docutils literal notranslate"><span class="pre">MemoryMap.freeze()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.align_to"><code class="docutils literal notranslate"><span class="pre">MemoryMap.align_to()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_resource"><code class="docutils literal notranslate"><span class="pre">MemoryMap.add_resource()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.resources"><code class="docutils literal notranslate"><span class="pre">MemoryMap.resources()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.add_window"><code class="docutils literal notranslate"><span class="pre">MemoryMap.add_window()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.windows"><code class="docutils literal notranslate"><span class="pre">MemoryMap.windows()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.window_patterns"><code class="docutils literal notranslate"><span class="pre">MemoryMap.window_patterns()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.all_resources"><code class="docutils literal notranslate"><span class="pre">MemoryMap.all_resources()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.find_resource"><code class="docutils literal notranslate"><span class="pre">MemoryMap.find_resource()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.memory.MemoryMap.decode_address"><code class="docutils literal notranslate"><span class="pre">MemoryMap.decode_address()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#amaranth_soc.memory.ResourceInfo"><code class="docutils literal notranslate"><span class="pre">ResourceInfo</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=1f169f65"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/platformpicker.js"></script>
    <script src="../_static/js/init.js?v=dbf28173"></script>
    </body>
</html>