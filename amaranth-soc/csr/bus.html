<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="CSR registers" href="reg.html" /><link rel="prev" title="CSR" href="../csr.html" />

    <link rel="shortcut icon" href="../../_static/favicon.png"/><!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>CSR bus - ChipFlow Platform Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../_static/platformpicker.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 0.9 rem;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 0.9 rem;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 0.9 rem;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">ChipFlow Platform Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/chipflow-logo.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">ChipFlow Platform Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../chipflow-lib/index.html">ChipFlow Library Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of ChipFlow Library Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chipflow-lib/getting-started.html">Getting Started with ChipFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chipflow-lib/chipflow-toml-guide.html">Intro to <code class="docutils literal notranslate"><span class="pre">chipflow.toml</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chipflow-lib/chipflow-commands.html">The <code class="docutils literal notranslate"><span class="pre">chipflow</span></code> command</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../chipflow-lib/autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../chipflow-lib/autoapi/chipflow_lib/index.html">chipflow_lib</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of chipflow_lib</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../chipflow-lib/autoapi/chipflow_lib/platforms/index.html">chipflow_lib.platforms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../chipflow-lib/autoapi/chipflow_lib/steps/index.html">chipflow_lib.steps</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../amaranth/index.html">Amaranth Language and Toolchain</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Amaranth Language and Toolchain</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../amaranth/intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../amaranth/install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../amaranth/start.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../amaranth/tutorial.html">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../amaranth/guide.html">Language guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../amaranth/reference.html">Language reference</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../amaranth/stdlib.html">Standard library</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Standard library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/stdlib/enum.html">Enumerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/stdlib/data.html">Data structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/stdlib/wiring.html">Interfaces and connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/stdlib/meta.html">Interface metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/stdlib/stream.html">Data streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/stdlib/memory.html">Memory arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/stdlib/io.html">Input/output buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/stdlib/cdc.html">Clock domain crossing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/stdlib/coding.html">Code conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/stdlib/fifo.html">First-in first-out queues</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../amaranth/stdlib/crc.html">Cyclic redundancy checks</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Cyclic redundancy checks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../amaranth/stdlib/crc/catalog.html">Algorithm catalog</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../amaranth/simulator.html">Simulator</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../amaranth/platform.html">Platform integration</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Platform integration</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/platform/altera.html">Altera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/platform/gowin.html">Gowin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/platform/lattice.html">Lattice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/platform/quicklogic.html">Quicklogic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/platform/siliconblue.html">SiliconBlue</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../amaranth/platform/xilinx.html">Xilinx</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../amaranth/changes.html">Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../amaranth/contrib.html">Contributing</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Amaranth System-on-a-Chip toolkit</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Amaranth System-on-a-Chip toolkit</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../memory.html">Memory maps</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../wishbone.html">Wishbone</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Wishbone</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../wishbone/bus.html">Wishbone bus</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../csr.html">CSR</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of CSR</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">CSR bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="reg.html">CSR registers</a></li>
<li class="toctree-l3"><a class="reference internal" href="action.html">CSR fields</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../gpio.html">GPIO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Support</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../chipflow-lib/autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../chipflow-lib/autoapi/chipflow_lib/index.html">chipflow_lib</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of chipflow_lib</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../chipflow-lib/autoapi/chipflow_lib/platforms/index.html">chipflow_lib.platforms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../chipflow-lib/autoapi/chipflow_lib/steps/index.html">chipflow_lib.steps</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/amaranth-soc/csr/bus.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="module-amaranth_soc.csr.bus">
<span id="csr-bus"></span><h1>CSR bus<a class="headerlink" href="#module-amaranth_soc.csr.bus" title="Link to this heading"></a></h1>
<p>The <a class="reference internal" href="#module-amaranth_soc.csr.bus" title="amaranth_soc.csr.bus"><code class="xref py py-mod docutils literal notranslate"><span class="pre">amaranth_soc.csr.bus</span></code></a> module contains primitives to implement and access the registers of peripherals through a bus interface.</p>
<section id="introduction">
<span id="csr-bus-introduction"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h3>
<p>The CSR bus API provides unopinionated primitives for defining and connecting the <em>Control and Status Registers</em> of SoC peripherals, with an emphasis on safety and resource efficiency. It is composed of low-level <a class="reference internal" href="#csr-bus-element"><span class="std std-ref">register interfaces</span></a>, <a class="reference internal" href="#csr-bus-multiplexer"><span class="std std-ref">multiplexers</span></a> that provide access to the registers of a peripheral, and <a class="reference internal" href="#csr-bus-decoder"><span class="std std-ref">bus decoders</span></a> that provide access to subordinate bus interfaces.</p>
<p>This diagram shows a CSR bus decoder being used to provide access to the registers of two peripherals:</p>
<img alt="../../_images/csr-bus.png" src="../../_images/csr-bus.png" />
</section>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h2>
<section id="defining-registers">
<span id="csr-bus-element"></span><h3>Defining registers<a class="headerlink" href="#defining-registers" title="Link to this heading"></a></h3>
<p>A CSR register is a <a class="reference internal" href="../../amaranth/stdlib/wiring.html#amaranth.lib.wiring.Component" title="amaranth.lib.wiring.Component"><code class="xref py py-class docutils literal notranslate"><span class="pre">Component</span></code></a> with an <a class="reference internal" href="#amaranth_soc.csr.bus.Element" title="amaranth_soc.csr.bus.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> member in its interface, oriented as input and named <code class="docutils literal notranslate"><span class="pre">&quot;element&quot;</span></code>.</p>
<p>For example, this component is a read/write register with a configurable width:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyRegister</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">({</span>
            <span class="s2">&quot;element&quot;</span><span class="p">:</span> <span class="n">In</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Element</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;rw&quot;</span><span class="p">)),</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">width</span><span class="p">),</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">elaborate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>
        <span class="n">storage</span> <span class="o">=</span> <span class="n">Signal</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">w_stb</span><span class="p">):</span>
            <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">storage</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">w_data</span><span class="p">)</span>

        <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r_data</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">storage</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">storage</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
<p>CSR bus transactions go through the <a class="reference internal" href="#amaranth_soc.csr.bus.Element" title="amaranth_soc.csr.bus.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> port and always target the entire register. Transactions are completed in one clock cycle, regardless of the register width. A read and a write access can be part of the same transaction.</p>
</section>
<section id="accessing-registers">
<span id="csr-bus-multiplexer"></span><h3>Accessing registers<a class="headerlink" href="#accessing-registers" title="Link to this heading"></a></h3>
<p>A <a class="reference internal" href="#amaranth_soc.csr.bus.Multiplexer" title="amaranth_soc.csr.bus.Multiplexer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Multiplexer</span></code></a> can provide access to the registers of a peripheral through a CSR bus <a class="reference internal" href="#amaranth_soc.csr.bus.Interface" title="amaranth_soc.csr.bus.Interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">Interface</span></code></a>. Registers must first be added to a <code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code>, which is used to instantiate the multiplexer.</p>
<p>The following example shows a very basic timer peripheral with an 8-bit CSR bus and two 24-bit registers, <code class="docutils literal notranslate"><span class="pre">Cnt</span></code> and <code class="docutils literal notranslate"><span class="pre">Rst</span></code>. The value of <code class="docutils literal notranslate"><span class="pre">Cnt</span></code> is incremented every clock cycle, and can be reset by a CSR bus write to <code class="docutils literal notranslate"><span class="pre">Rst</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">BasicTimer</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Cnt</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
        <span class="n">element</span><span class="p">:</span> <span class="n">In</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Element</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">access</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">))</span>
        <span class="n">r_stb</span><span class="p">:</span>   <span class="n">Out</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">r_data</span><span class="p">:</span>  <span class="n">In</span><span class="p">(</span><span class="n">unsigned</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">elaborate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>
            <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_stb</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r_stb</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r_data</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_data</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="n">m</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Rst</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
        <span class="n">element</span><span class="p">:</span> <span class="n">In</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Element</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">access</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">w_stb</span><span class="p">:</span>   <span class="n">Out</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">w_data</span><span class="p">:</span>  <span class="n">Out</span><span class="p">(</span><span class="n">unsigned</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">elaborate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>
            <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">w_stb</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">w_stb</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">w_data</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">w_data</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">({</span>
            <span class="s2">&quot;csr_bus&quot;</span><span class="p">:</span> <span class="n">In</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">addr_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="mi">8</span><span class="p">)),</span>
        <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_reg_cnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cnt</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reg_rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rst</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">csr_bus</span><span class="o">.</span><span class="n">memory_map</span> <span class="o">=</span> <span class="n">MemoryMap</span><span class="p">(</span><span class="n">addr_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csr_bus</span><span class="o">.</span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reg_cnt</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;cnt&quot;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csr_bus</span><span class="o">.</span><span class="n">memory_map</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reg_rst</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;rst&quot;</span><span class="p">,))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_csr_mux</span> <span class="o">=</span> <span class="n">csr</span><span class="o">.</span><span class="n">Multiplexer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csr_bus</span><span class="o">.</span><span class="n">memory_map</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">elaborate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>
        <span class="n">m</span><span class="o">.</span><span class="n">submodules</span><span class="o">.</span><span class="n">reg_cnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reg_cnt</span>
        <span class="n">m</span><span class="o">.</span><span class="n">submodules</span><span class="o">.</span><span class="n">reg_rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reg_rst</span>
        <span class="n">m</span><span class="o">.</span><span class="n">submodules</span><span class="o">.</span><span class="n">csr_mux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csr_mux</span>

        <span class="n">connect</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">flipped</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csr_bus</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csr_mux</span><span class="o">.</span><span class="n">bus</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">unsigned</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span>

        <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reg_cnt</span><span class="o">.</span><span class="n">r_data</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reg_rst</span><span class="o">.</span><span class="n">w_stb</span><span class="p">):</span>
            <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">count</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reg_rst</span><span class="o">.</span><span class="n">w_data</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">Else</span><span class="p">():</span>
            <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">count</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timer</span> <span class="o">=</span> <span class="n">BasicTimer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">res_info</span> <span class="ow">in</span> <span class="n">timer</span><span class="o">.</span><span class="n">csr_bus</span><span class="o">.</span><span class="n">memory_map</span><span class="o">.</span><span class="n">all_resources</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">res_info</span><span class="p">)</span>
<span class="go">ResourceInfo(path=(Name(&#39;cnt&#39;),), start=0x0, end=0x4, width=8)</span>
<span class="go">ResourceInfo(path=(Name(&#39;rst&#39;),), start=0x4, end=0x8, width=8)</span>
</pre></div>
</div>
<p>Registers are always accessed atomically, regardless of their size. Each register is split into chunks according to the CSR bus data width, and each chunk is assigned a consecutive address on the bus.</p>
<p>In this example, the sizes of <code class="docutils literal notranslate"><span class="pre">Cnt</span></code> and <code class="docutils literal notranslate"><span class="pre">Rst</span></code> are extended from 24 to 32 bits, because they were added to <code class="docutils literal notranslate"><span class="pre">csr_bus.memory_map</span></code> with an <a class="reference internal" href="../memory.html#memory-alignment"><span class="std std-ref">alignment</span></a> of 32 bits.</p>
<p>The following diagram shows a read transaction from the <code class="docutils literal notranslate"><span class="pre">Cnt</span></code> register:</p>
<img src="_images/csr/bus/example_mux_read.svg" class="wavedrom wavedrom-signal" alt="{'head': {'tick': 0}, 'signal': [{'name': 'clk', 'wave': 'p......'}, {'node': '.AB...C'}, ['csr_bus', {'name': 'addr', 'wave': 'x====x.', 'data': [0, 1, 2, 3]}, {'name': 'r_stb', 'wave': '01...0.'}, {'name': 'r_data', 'wave': '0.45670', 'node': '..1234.', 'data': ['0x01', '0x00', '0xa5', '0x00']}], {}, ['csr_mux', {'name': 'r_shadow', 'wave': 'x.3...x', 'node': '..b....', 'data': ['0xa50001']}], {}, ['reg_cnt', {'name': 'r_stb', 'wave': '010....'}, {'name': 'r_data', 'wave': '=3=====', 'node': '.a.....', 'data': ['0xa50000', '0xa50001', '0xa50002', '0xa50003', '0xa50004', '0xa50005', '0xa50006']}]], 'edge': ['A+B t1', 'a-~&gt;b', 'B+C t2', 'b~&gt;1'], 'config': {'hscale': 2, 'skin': 'default'}}"><p>The <a class="reference internal" href="#amaranth_soc.csr.bus.Multiplexer" title="amaranth_soc.csr.bus.Multiplexer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Multiplexer</span></code></a> adds a delay of 1 clock cycle to CSR bus reads (represented by <em>t1</em>) between the time of assertion of <code class="docutils literal notranslate"><span class="pre">csr_bus.r_stb</span></code> and the time the first chunk is transmitted to <code class="docutils literal notranslate"><span class="pre">csr_bus.r_data</span></code>.</p>
<p>A read transaction targeting <code class="docutils literal notranslate"><span class="pre">Cnt</span></code> requires 4 bus reads to complete and has a latency of 4 clock cycles (represented by <em>t2</em>).</p>
<p>When the first chunk of <code class="docutils literal notranslate"><span class="pre">Cnt</span></code> is read, the value of all of its chunks (at point labelled <em>a</em>) is captured by a shadow register internal to the multiplexer (at point labelled <em>b</em>). Reads from any chunk return the captured values (at points labelled <em>1</em>, <em>2</em>, <em>3</em>, <em>4</em>).</p>
<p>The following diagram shows a write transaction to the <code class="docutils literal notranslate"><span class="pre">Rst</span></code> register, which resets the value of the <code class="docutils literal notranslate"><span class="pre">Cnt</span></code> register as a side-effect:</p>
<img src="_images/csr/bus/example_mux_write.svg" class="wavedrom wavedrom-signal" alt="{'head': {'tick': 0}, 'signal': [{'name': 'clk', 'wave': 'p......'}, {'node': '.A...BC'}, ['csr_bus', {'name': 'addr', 'wave': 'x====x.', 'data': [4, 5, 6, 7]}, {'name': 'w_stb', 'wave': '01...0.'}, {'name': 'w_data', 'wave': 'x4567x.', 'node': '.1234..', 'data': ['0x44', '0x55', '0x66', '0x00']}], {}, ['csr_mux', {'name': 'w_shadow', 'wave': 'x.===3x', 'node': '..a..b', 'data': ['0x000044', '0x005544', '0x665544', '0x665544']}], {}, ['reg_rst', {'name': 'w_stb', 'wave': '0....10'}, {'name': 'w_data', 'wave': 'x....3x', 'node': '.....c.', 'data': ['0x665544']}], {}, ['reg_cnt', {'name': 'r_data', 'wave': '======3', 'node': '......d', 'data': ['0xa50007', '0xa50008', '0xa50009', '0xa5000a', '0xa5000b', '0xa5000c', '0x665544']}], {}], 'edge': ['A+B t1', '1~-&gt;a', 'B+C t2', 'b~-&gt;c', 'c~-&gt;d'], 'config': {'hscale': 2, 'skin': 'default'}}"><p>A write transaction targeting <code class="docutils literal notranslate"><span class="pre">Rst</span></code> requires 4 bus writes to complete and has a latency of 4 clock cycles (represented by <em>t1</em>).</p>
<p>When a chunk of <code class="docutils literal notranslate"><span class="pre">Rst</span></code> is written (at point labelled <em>1</em>), the written value is captured by a shadow register internal to the multiplexer (at point labelled <em>a</em>). A write to the last chunk (at point labelled <em>4</em>) causes all captured values to be written to the register (at point labelled <em>c</em>).</p>
<p>The <a class="reference internal" href="#amaranth_soc.csr.bus.Multiplexer" title="amaranth_soc.csr.bus.Multiplexer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Multiplexer</span></code></a> adds a delay of 1 clock cycle to CSR bus writes (represented by <em>t2</em>) between the time of assertion of <code class="docutils literal notranslate"><span class="pre">csr_bus.w_stb</span></code> and the time of assertion of <code class="docutils literal notranslate"><span class="pre">reg_rst.w_stb</span></code>.</p>
<p>As a side-effect of the transaction, the next value of <code class="docutils literal notranslate"><span class="pre">Cnt</span></code> becomes the value that was written to <code class="docutils literal notranslate"><span class="pre">Rst</span></code> (at point labelled <em>d</em>).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To safely access registers over the bus interface of a <a class="reference internal" href="#amaranth_soc.csr.bus.Multiplexer" title="amaranth_soc.csr.bus.Multiplexer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Multiplexer</span></code></a>, the following
rules apply:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>the bus initiator must have exclusive ownership over the address range of the multiplexer until the register transaction is either completed or aborted.</p></li>
<li><p>the bus initiator must access a register in ascending order of addresses, but it may abort the transaction after any bus cycle.</p></li>
</ol>
</div></blockquote>
</div>
</section>
<section id="accessing-a-hierarchy-of-registers">
<span id="csr-bus-decoder"></span><h3>Accessing a hierarchy of registers<a class="headerlink" href="#accessing-a-hierarchy-of-registers" title="Link to this heading"></a></h3>
<p>A <a class="reference internal" href="#amaranth_soc.csr.bus.Decoder" title="amaranth_soc.csr.bus.Decoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">Decoder</span></code></a> can provide access to group of <a class="reference internal" href="#amaranth_soc.csr.bus.Multiplexer" title="amaranth_soc.csr.bus.Multiplexer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Multiplexer</span></code></a>s and subordinate <a class="reference internal" href="#amaranth_soc.csr.bus.Decoder" title="amaranth_soc.csr.bus.Decoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">Decoder</span></code></a>s, forming a hierarchical address space of CSR registers.</p>
<p>In the following example, a CSR decoder provides access to the registers of two peripherals:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">timer0</span> <span class="o">=</span> <span class="n">BasicTimer</span><span class="p">()</span>
<span class="n">timer1</span> <span class="o">=</span> <span class="n">BasicTimer</span><span class="p">()</span>

<span class="n">csr_dec</span> <span class="o">=</span> <span class="n">csr</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">addr_width</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">csr_dec</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">timer0</span><span class="o">.</span><span class="n">csr_bus</span><span class="p">,</span> <span class="n">addr</span><span class="o">=</span><span class="mh">0x0000</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;timer0&quot;</span><span class="p">)</span>
<span class="n">csr_dec</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">timer1</span><span class="o">.</span><span class="n">csr_bus</span><span class="p">,</span> <span class="n">addr</span><span class="o">=</span><span class="mh">0x1000</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;timer1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">res_info</span> <span class="ow">in</span> <span class="n">csr_dec</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">memory_map</span><span class="o">.</span><span class="n">all_resources</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">res_info</span><span class="p">)</span>
<span class="go">ResourceInfo(path=(Name(&#39;timer0&#39;), Name(&#39;cnt&#39;)), start=0x0, end=0x4, width=8)</span>
<span class="go">ResourceInfo(path=(Name(&#39;timer0&#39;), Name(&#39;rst&#39;)), start=0x4, end=0x8, width=8)</span>
<span class="go">ResourceInfo(path=(Name(&#39;timer1&#39;), Name(&#39;cnt&#39;)), start=0x1000, end=0x1004, width=8)</span>
<span class="go">ResourceInfo(path=(Name(&#39;timer1&#39;), Name(&#39;rst&#39;)), start=0x1004, end=0x1008, width=8)</span>
</pre></div>
</div>
<p>Although there is no functional difference between adding a group of registers directly to a <a class="reference internal" href="#amaranth_soc.csr.bus.Multiplexer" title="amaranth_soc.csr.bus.Multiplexer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Multiplexer</span></code></a> and adding them to multiple <a class="reference internal" href="#amaranth_soc.csr.bus.Multiplexer" title="amaranth_soc.csr.bus.Multiplexer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Multiplexer</span></code></a>s that are aggregated with a <a class="reference internal" href="#amaranth_soc.csr.bus.Decoder" title="amaranth_soc.csr.bus.Decoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">Decoder</span></code></a>, hierarchical CSR buses are useful for organizing a hierarchical design.</p>
<p>If many peripherals are directly served by a single <a class="reference internal" href="#amaranth_soc.csr.bus.Multiplexer" title="amaranth_soc.csr.bus.Multiplexer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Multiplexer</span></code></a>, a very large amount of ports will connect the peripheral registers to the multiplexer, and the cost of decoding logic would not be attributed to specific peripherals. With a <a class="reference internal" href="#amaranth_soc.csr.bus.Decoder" title="amaranth_soc.csr.bus.Decoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">Decoder</span></code></a>, only five signals per peripheral will be used, and the logic could be kept together with the peripheral.</p>
</section>
</section>
<section id="register-interfaces">
<h2>Register interfaces<a class="headerlink" href="#register-interfaces" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Element.Access">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Element.</span></span><span class="sig-name descname"><span class="pre">Access</span></span><a class="headerlink" href="#amaranth_soc.csr.bus.Element.Access" title="Link to this definition"></a></dt>
<dd><p>Register access mode.</p>
<p>Coarse access mode for the entire register. Individual fields can have more restrictive
access mode, e.g. R/O fields can be a part of an R/W register.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Element.Access.R">
<span class="sig-name descname"><span class="pre">R</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'r'</span></em><a class="headerlink" href="#amaranth_soc.csr.bus.Element.Access.R" title="Link to this definition"></a></dt>
<dd><p>Read-only mode.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Element.Access.W">
<span class="sig-name descname"><span class="pre">W</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'w'</span></em><a class="headerlink" href="#amaranth_soc.csr.bus.Element.Access.W" title="Link to this definition"></a></dt>
<dd><p>Write-only mode.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Element.Access.RW">
<span class="sig-name descname"><span class="pre">RW</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'rw'</span></em><a class="headerlink" href="#amaranth_soc.csr.bus.Element.Access.RW" title="Link to this definition"></a></dt>
<dd><p>Read/write mode.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Element.Access.readable">
<span class="sig-name descname"><span class="pre">readable</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.csr.bus.Element.Access.readable" title="Link to this definition"></a></dt>
<dd><p>Readable access mode.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if equal to <a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access.R" title="amaranth_soc.csr.bus.Element.Access.R"><code class="xref py py-attr docutils literal notranslate"><span class="pre">R</span></code></a> or <a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access.RW" title="amaranth_soc.csr.bus.Element.Access.RW"><code class="xref py py-attr docutils literal notranslate"><span class="pre">RW</span></code></a>.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Element.Access.writable">
<span class="sig-name descname"><span class="pre">writable</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.csr.bus.Element.Access.writable" title="Link to this definition"></a></dt>
<dd><p>Writable access mode.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if equal to <a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access.W" title="amaranth_soc.csr.bus.Element.Access.W"><code class="xref py py-attr docutils literal notranslate"><span class="pre">W</span></code></a> or <a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access.RW" title="amaranth_soc.csr.bus.Element.Access.RW"><code class="xref py py-attr docutils literal notranslate"><span class="pre">RW</span></code></a>.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Element.Signature">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Element.</span></span><span class="sig-name descname"><span class="pre">Signature</span></span><a class="headerlink" href="#amaranth_soc.csr.bus.Element.Signature" title="Link to this definition"></a></dt>
<dd><p>CSR register signature.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>width</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Width of the register.</p></li>
<li><p><strong>access</strong> (<a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access" title="amaranth_soc.csr.bus.Element.Access"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element.Access</span></code></a>) – Register access mode.</p></li>
</ul>
</dd>
<dt class="field-even">Members<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>r_data</strong> (<code class="code highlight py python docutils literal highlight-python"><span class="n">In</span><span class="p">(</span><span class="n">width</span><span class="p">)</span></code>) – Read data. Must be always valid, and is sampled when <code class="docutils literal notranslate"><span class="pre">r_stb</span></code> is asserted.</p></li>
<li><p><strong>r_stb</strong> (<code class="code highlight py python docutils literal highlight-python"><span class="n">Out</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code>) – Read strobe. Registers with read side effects should perform the read side effect when
this strobe is asserted.</p></li>
<li><p><strong>w_data</strong> (<code class="code highlight py python docutils literal highlight-python"><span class="n">Out</span><span class="p">(</span><span class="n">width</span><span class="p">)</span></code>) – Write data. Valid only when <code class="docutils literal notranslate"><span class="pre">w_stb</span></code> is asserted.</p></li>
<li><p><strong>w_stb</strong> (<code class="code highlight py python docutils literal highlight-python"><span class="n">Out</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code>) – Write strobe. Registers should update their value or perform the write side effect when
this strobe is asserted.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Element.Signature.create">
<span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">src_loc_at</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.csr.bus.Element.Signature.create" title="Link to this definition"></a></dt>
<dd><p>Create a compatible interface.</p>
<p>See <a class="reference internal" href="../../amaranth/stdlib/wiring.html#amaranth.lib.wiring.Signature.create" title="amaranth.lib.wiring.Signature.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">amaranth.lib.wiring.Signature.create()</span></code></a> for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth_soc.csr.bus.Element" title="amaranth_soc.csr.bus.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Element.Signature.__eq__">
<span class="sig-name descname"><span class="pre">__eq__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.csr.bus.Element.Signature.__eq__" title="Link to this definition"></a></dt>
<dd><p>Compare signatures.</p>
<p>Two signatures are equal if they have the same width and register access mode.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Element">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth_soc.csr.bus.</span></span><span class="sig-name descname"><span class="pre">Element</span></span><a class="headerlink" href="#amaranth_soc.csr.bus.Element" title="Link to this definition"></a></dt>
<dd><p>CSR register interface.</p>
<p>A low-level interface to a single atomically readable and writable register in a peripheral.
This interface supports any register width and semantics, provided that both reads and writes
always succeed and complete in one cycle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>width</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Width of the register.</p></li>
<li><p><strong>access</strong> (<a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access" title="amaranth_soc.csr.bus.Element.Access"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element.Access</span></code></a>) – Register access mode.</p></li>
<li><p><strong>path</strong> (iterable of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – Path to this interface. Optional. See <a class="reference internal" href="../../amaranth/stdlib/wiring.html#amaranth.lib.wiring.PureInterface" title="amaranth.lib.wiring.PureInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">amaranth.lib.wiring.PureInterface</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="bus-interfaces">
<span id="csr-bus-interface"></span><h2>Bus interfaces<a class="headerlink" href="#bus-interfaces" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Signature">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth_soc.csr.bus.</span></span><span class="sig-name descname"><span class="pre">Signature</span></span><a class="headerlink" href="#amaranth_soc.csr.bus.Signature" title="Link to this definition"></a></dt>
<dd><p>CSR bus signature.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>addr_width</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Address width. At most <code class="docutils literal notranslate"><span class="pre">(2</span> <span class="pre">**</span> <span class="pre">addr_width)</span> <span class="pre">*</span> <span class="pre">data_width</span></code> register bits will be available.</p></li>
<li><p><strong>data_width</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Data width. Registers are accessed in <code class="docutils literal notranslate"><span class="pre">data_width</span></code> sized chunks.</p></li>
</ul>
</dd>
<dt class="field-even">Members<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>addr</strong> (<code class="code highlight py python docutils literal highlight-python"><span class="n">Out</span><span class="p">(</span><span class="n">addr_width</span><span class="p">)</span></code>) – Address for reads and writes.</p></li>
<li><p><strong>r_data</strong> (<code class="code highlight py python docutils literal highlight-python"><span class="n">In</span><span class="p">(</span><span class="n">data_width</span><span class="p">)</span></code>) – Read data. Valid on the next cycle after <code class="docutils literal notranslate"><span class="pre">r_stb</span></code> is asserted. Otherwise, zero. (Keeping
read data of an unused interface at zero simplifies multiplexers.)</p></li>
<li><p><strong>r_stb</strong> (<code class="code highlight py python docutils literal highlight-python"><span class="n">Out</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code>) – Read strobe. If <code class="docutils literal notranslate"><span class="pre">addr</span></code> points to the first chunk of a register, captures register value
and causes read side effects to be performed (if any). If <code class="docutils literal notranslate"><span class="pre">addr</span></code> points to any chunk
of a register, latches the captured value to <code class="docutils literal notranslate"><span class="pre">r_data</span></code>. Otherwise, latches zero
to <code class="docutils literal notranslate"><span class="pre">r_data</span></code>.</p></li>
<li><p><strong>w_data</strong> (<code class="code highlight py python docutils literal highlight-python"><span class="n">Out</span><span class="p">(</span><span class="n">data_width</span><span class="p">)</span></code>) – Write data. Must be valid when <code class="docutils literal notranslate"><span class="pre">w_stb</span></code> is asserted.</p></li>
<li><p><strong>w_stb</strong> (<code class="code highlight py python docutils literal highlight-python"><span class="n">Out</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code>) – Write strobe. If <code class="docutils literal notranslate"><span class="pre">addr</span></code> points to the last chunk of a register, writes captured value
to the register and causes write side effects to be performed (if any). If <code class="docutils literal notranslate"><span class="pre">addr</span></code> points
to any chunk of a register, latches <code class="docutils literal notranslate"><span class="pre">w_data</span></code> to the captured value. Otherwise, does
nothing.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Signature.create">
<span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">src_loc_at</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.csr.bus.Signature.create" title="Link to this definition"></a></dt>
<dd><p>Create a compatible interface.</p>
<p>See <a class="reference internal" href="../../amaranth/stdlib/wiring.html#amaranth.lib.wiring.Signature.create" title="amaranth.lib.wiring.Signature.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">amaranth.lib.wiring.Signature.create()</span></code></a> for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth_soc.csr.bus.Interface" title="amaranth_soc.csr.bus.Interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">Interface</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Signature.__eq__">
<span class="sig-name descname"><span class="pre">__eq__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.csr.bus.Signature.__eq__" title="Link to this definition"></a></dt>
<dd><p>Compare signatures.</p>
<p>Two signatures are equal if they have the same address width and data width.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Interface">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth_soc.csr.bus.</span></span><span class="sig-name descname"><span class="pre">Interface</span></span><a class="headerlink" href="#amaranth_soc.csr.bus.Interface" title="Link to this definition"></a></dt>
<dd><p>CSR bus interface.</p>
<p>A low-level interface to a set of atomically readable and writable peripheral CSR registers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>addr_width</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Address width. See <a class="reference internal" href="#amaranth_soc.csr.bus.Signature" title="amaranth_soc.csr.bus.Signature"><code class="xref py py-class docutils literal notranslate"><span class="pre">Signature</span></code></a>.</p></li>
<li><p><strong>data_width</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Data width. See <a class="reference internal" href="#amaranth_soc.csr.bus.Signature" title="amaranth_soc.csr.bus.Signature"><code class="xref py py-class docutils literal notranslate"><span class="pre">Signature</span></code></a>.</p></li>
<li><p><strong>path</strong> (iterable of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – Path to this CSR interface. Optional. See <a class="reference internal" href="../../amaranth/stdlib/wiring.html#amaranth.lib.wiring.PureInterface" title="amaranth.lib.wiring.PureInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">amaranth.lib.wiring.PureInterface</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Interface.memory_map">
<span class="sig-name descname"><span class="pre">memory_map</span></span><a class="headerlink" href="#amaranth_soc.csr.bus.Interface.memory_map" title="Link to this definition"></a></dt>
<dd><p>Memory map of the bus.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="../memory.html#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a> or <code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If set to a memory map that does not have the same address and data widths as the bus
    interface.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="bus-primitives">
<h2>Bus primitives<a class="headerlink" href="#bus-primitives" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Multiplexer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth_soc.csr.bus.</span></span><span class="sig-name descname"><span class="pre">Multiplexer</span></span><a class="headerlink" href="#amaranth_soc.csr.bus.Multiplexer" title="Link to this definition"></a></dt>
<dd><p>CSR register multiplexer.</p>
<p>An address-based multiplexer for CSR registers implementing atomic updates.</p>
<p>Writes are registered, and are performed 1 cycle after <code class="docutils literal notranslate"><span class="pre">w_stb</span></code> is asserted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because the CSR bus conserves logic and routing resources, it is common to e.g. bridge a CSR
bus with a narrow <em>N</em>-bit datapath to a CPU with a wider <em>W</em>-bit datapath (<em>W&gt;N</em>) in cases
where CSR access latency is less important than resource usage.</p>
<p>In this case, two strategies are possible for connecting the CSR bus to the CPU:</p>
<blockquote>
<div><ul class="simple">
<li><p>The CPU could access the CSR bus directly (with no intervening logic other than simple
translation of control signals). The register alignment should be set to 1 (i.e.
<code class="docutils literal notranslate"><span class="pre">memory_map.alignment</span></code> should be 0), and each <em>R</em>-bit register would occupy
<em>ceil(R/N)</em> addresses from the CPU perspective, requiring the same amount of memory
instructions to access.</p></li>
<li><p>The CPU could access the CSR bus through a width down-converter, which would issue
<em>W/N</em> CSR accesses for each CPU access. The register alignment should be set to <em>W/N</em>,
and each <em>R</em>-bit register would occupy <em>ceil(R/K)</em> addresses from the CPU perspective,
requiring the same amount of memory instructions to access.</p></li>
</ul>
</div></blockquote>
<p>If the register alignment is greater than 1, it affects which CSR bus write is considered a
write to the last register chunk. For example, if a 24-bit register is accessed through an
8-bit CSR bus and a CPU with a 32-bit datapath, a write to this register requires 4 CSR bus
writes to complete, and the last write is the one that actually writes the value to the
register. This allows determining write latency solely from the amount of addresses occupied
by the register in the CPU address space, and the CSR bus data width.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>memory_map</strong> (<a class="reference internal" href="../memory.html#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a>) – Memory map of CSR registers.</p></li>
<li><p><strong>shadow_overlaps</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Maximum number of CSR registers that can share a chunk of a shadow register.
Optional. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, any number of CSR registers can share a shadow chunk.</p></li>
</ul>
</dd>
<dt class="field-even">Members<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>bus</strong> (<code class="code highlight py python docutils literal highlight-python"><span class="n">In</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">memory_map</span><span class="o">.</span><span class="n">addr_width</span><span class="p">,</span> <span class="n">memory_map</span><span class="o">.</span><span class="n">data_width</span><span class="p">))</span></code>) – CSR bus providing access to registers.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Decoder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth_soc.csr.bus.</span></span><span class="sig-name descname"><span class="pre">Decoder</span></span><a class="headerlink" href="#amaranth_soc.csr.bus.Decoder" title="Link to this definition"></a></dt>
<dd><p>CSR bus decoder.</p>
<p>An address decoder for subordinate CSR buses.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>addr_width</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Address width. See <a class="reference internal" href="#amaranth_soc.csr.bus.Interface" title="amaranth_soc.csr.bus.Interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">Interface</span></code></a>.</p></li>
<li><p><strong>data_width</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Data width. See <a class="reference internal" href="#amaranth_soc.csr.bus.Interface" title="amaranth_soc.csr.bus.Interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">Interface</span></code></a>.</p></li>
<li><p><strong>alignment</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, power-of-2 exponent) – Window alignment. See <a class="reference internal" href="../memory.html#amaranth_soc.memory.MemoryMap" title="amaranth_soc.memory.MemoryMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryMap</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Members<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>bus</strong> (<code class="code highlight py python docutils literal highlight-python"><span class="n">In</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">addr_width</span><span class="p">,</span> <span class="n">data_width</span><span class="p">))</span></code>) – CSR bus providing access to subordinate buses.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Decoder.align_to">
<span class="sig-name descname"><span class="pre">align_to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alignment</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.csr.bus.Decoder.align_to" title="Link to this definition"></a></dt>
<dd><p>Align the implicit address of the next window.</p>
<p>See <a class="reference internal" href="../memory.html#amaranth_soc.memory.MemoryMap.align_to" title="amaranth_soc.memory.MemoryMap.align_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">align_to()</span></code></a> for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Implicit next address.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth_soc.csr.bus.Decoder.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sub_bus</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">addr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth_soc.csr.bus.Decoder.add" title="Link to this definition"></a></dt>
<dd><p>Add a window to a subordinate bus.</p>
<p>See <a class="reference internal" href="../memory.html#amaranth_soc.memory.MemoryMap.add_window" title="amaranth_soc.memory.MemoryMap.add_window"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_window()</span></code></a> for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A tuple <code class="docutils literal notranslate"><span class="pre">(start,</span> <span class="pre">end,</span> <span class="pre">ratio)</span></code> describing the address range assigned to the window.
<code class="docutils literal notranslate"><span class="pre">ratio</span></code> is always 1.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If the subordinate bus data width is not equal to the <a class="reference internal" href="#amaranth_soc.csr.bus.Decoder" title="amaranth_soc.csr.bus.Decoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">Decoder</span></code></a> data width.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="reg.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">CSR registers</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../csr.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">CSR</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, ChipFlow
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">CSR bus</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#defining-registers">Defining registers</a></li>
<li><a class="reference internal" href="#accessing-registers">Accessing registers</a></li>
<li><a class="reference internal" href="#accessing-a-hierarchy-of-registers">Accessing a hierarchy of registers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#register-interfaces">Register interfaces</a><ul>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access"><code class="docutils literal notranslate"><span class="pre">Element.Access</span></code></a><ul>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access.R"><code class="docutils literal notranslate"><span class="pre">Element.Access.R</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access.W"><code class="docutils literal notranslate"><span class="pre">Element.Access.W</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access.RW"><code class="docutils literal notranslate"><span class="pre">Element.Access.RW</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access.readable"><code class="docutils literal notranslate"><span class="pre">Element.Access.readable()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Element.Access.writable"><code class="docutils literal notranslate"><span class="pre">Element.Access.writable()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Element.Signature"><code class="docutils literal notranslate"><span class="pre">Element.Signature</span></code></a><ul>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Element.Signature.create"><code class="docutils literal notranslate"><span class="pre">Element.Signature.create()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Element.Signature.__eq__"><code class="docutils literal notranslate"><span class="pre">Element.Signature.__eq__()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Element"><code class="docutils literal notranslate"><span class="pre">Element</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#bus-interfaces">Bus interfaces</a><ul>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Signature"><code class="docutils literal notranslate"><span class="pre">Signature</span></code></a><ul>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Signature.create"><code class="docutils literal notranslate"><span class="pre">Signature.create()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Signature.__eq__"><code class="docutils literal notranslate"><span class="pre">Signature.__eq__()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Interface"><code class="docutils literal notranslate"><span class="pre">Interface</span></code></a><ul>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Interface.memory_map"><code class="docutils literal notranslate"><span class="pre">Interface.memory_map</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#bus-primitives">Bus primitives</a><ul>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Multiplexer"><code class="docutils literal notranslate"><span class="pre">Multiplexer</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Decoder"><code class="docutils literal notranslate"><span class="pre">Decoder</span></code></a><ul>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Decoder.align_to"><code class="docutils literal notranslate"><span class="pre">Decoder.align_to()</span></code></a></li>
<li><a class="reference internal" href="#amaranth_soc.csr.bus.Decoder.add"><code class="docutils literal notranslate"><span class="pre">Decoder.add()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=1f169f65"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/platformpicker.js"></script>
    <script src="../../_static/js/init.js"></script>
    </body>
</html>