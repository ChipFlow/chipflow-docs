<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Platform integration" href="platform.html" /><link rel="prev" title="Algorithm catalog" href="stdlib/crc/catalog.html" />

    <link rel="shortcut icon" href="../_static/favicon.png"/><!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Simulator - ChipFlow Platform Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../_static/platformpicker.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 0.9 rem;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 0.9 rem;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 0.9 rem;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">ChipFlow Platform Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/chipflow-logo.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">ChipFlow Platform Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../chipflow-lib/getting-started.html">Getting Started with ChipFlow</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chipflow-lib/index.html">ChipFlow Library Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of ChipFlow Library Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/getting-started.html">Getting Started with ChipFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/architecture.html">ChipFlow Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/simulation-guide.html">Simulation Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/chipflow-toml-guide.html">Intro to <code class="docutils literal notranslate"><span class="pre">chipflow.toml</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/chipflow-toml-guide.html#project-name">project_name</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/chipflow-toml-guide.html#clock-domains">clock_domains</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/chipflow-toml-guide.html#process">process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/chipflow-toml-guide.html#package">package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/chipflow-commands.html">The <code class="docutils literal notranslate"><span class="pre">chipflow</span></code> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/using-pin-signatures.html">Using Pin Signatures and Software Drivers</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../chipflow-lib/platform-api.html">Platform API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Platform API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-lib/contributor-pin-signature-internals.html">Pin Signature Architecture (Contributor Guide)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chipflow-digital-ip/index.html">Digital IP Library</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Digital IP Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-digital-ip/base.html">Base Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-digital-ip/io.html">I/O Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-digital-ip/memory.html">Memory Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chipflow-digital-ip/processors.html">Processors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chipflow-digital-ip/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Amaranth Language and Toolchain</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Amaranth Language and Toolchain</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="start.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide.html">Language guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html">Language reference</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="stdlib.html">Standard library</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Standard library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="stdlib/enum.html">Enumerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="stdlib/data.html">Data structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="stdlib/wiring.html">Interfaces and connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="stdlib/meta.html">Interface metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="stdlib/stream.html">Data streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="stdlib/memory.html">Memory arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="stdlib/io.html">Input/output buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="stdlib/cdc.html">Clock domain crossing</a></li>
<li class="toctree-l3"><a class="reference internal" href="stdlib/coding.html">Code conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="stdlib/fifo.html">First-in first-out queues</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="stdlib/crc.html">Cyclic redundancy checks</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Cyclic redundancy checks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="stdlib/crc/catalog.html">Algorithm catalog</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Simulator</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="platform.html">Platform integration</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Platform integration</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="platform/altera.html">Altera</a></li>
<li class="toctree-l3"><a class="reference internal" href="platform/gowin.html">Gowin</a></li>
<li class="toctree-l3"><a class="reference internal" href="platform/lattice.html">Lattice</a></li>
<li class="toctree-l3"><a class="reference internal" href="platform/quicklogic.html">Quicklogic</a></li>
<li class="toctree-l3"><a class="reference internal" href="platform/siliconblue.html">SiliconBlue</a></li>
<li class="toctree-l3"><a class="reference internal" href="platform/xilinx.html">Xilinx</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changes.html">Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="contrib.html">Contributing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../amaranth-soc/index.html">Amaranth System-on-a-Chip toolkit</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Amaranth System-on-a-Chip toolkit</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../amaranth-soc/memory.html">Memory maps</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../amaranth-soc/wishbone.html">Wishbone</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Wishbone</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../amaranth-soc/wishbone/bus.html">Wishbone bus</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../amaranth-soc/csr.html">CSR</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of CSR</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../amaranth-soc/csr/bus.html">CSR bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth-soc/csr/reg.html">CSR registers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amaranth-soc/csr/action.html">CSR fields</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../amaranth-soc/gpio.html">GPIO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chipflow-lib/autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../chipflow-lib/autoapi/chipflow_lib/index.html">chipflow_lib</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of chipflow_lib</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../chipflow-lib/autoapi/chipflow_lib/config/index.html">chipflow_lib.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../chipflow-lib/autoapi/chipflow_lib/platforms/index.html">chipflow_lib.platforms</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../chipflow-lib/autoapi/chipflow_lib/steps/index.html">chipflow_lib.steps</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of chipflow_lib.steps</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../chipflow-lib/autoapi/chipflow_lib/steps/board/index.html">chipflow_lib.steps.board</a></li>
<li class="toctree-l4"><a class="reference internal" href="../chipflow-lib/autoapi/chipflow_lib/steps/sim/index.html">chipflow_lib.steps.sim</a></li>
<li class="toctree-l4"><a class="reference internal" href="../chipflow-lib/autoapi/chipflow_lib/steps/software/index.html">chipflow_lib.steps.software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/amaranth/simulator.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="module-amaranth.sim">
<span id="simulator"></span><h1>Simulator<a class="headerlink" href="#module-amaranth.sim" title="Link to this heading"></a></h1>
<p>The <a class="reference internal" href="#module-amaranth.sim" title="amaranth.sim"><code class="xref py py-mod docutils literal notranslate"><span class="pre">amaranth.sim</span></code></a> module, also known as the simulator, makes it possible to evaluate a design’s functionality in a virtual environment before it is implemented in hardware.</p>
<section id="simulating-circuits">
<h2>Simulating circuits<a class="headerlink" href="#simulating-circuits" title="Link to this heading"></a></h2>
<p>The following examples simulate one of the two designs below: synchronous counter running in the <code class="docutils literal notranslate"><span class="pre">sync</span></code> clock domain, and combinational adder. They assume familiarity with the <span class="amaranth">language guide &lt;guide&gt;</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">amaranth.lib</span><span class="w"> </span><span class="kn">import</span> <span class="n">wiring</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">amaranth.lib.wiring</span><span class="w"> </span><span class="kn">import</span> <span class="n">In</span><span class="p">,</span> <span class="n">Out</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Counter</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
    <span class="n">en</span><span class="p">:</span> <span class="n">In</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">count</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">elaborate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">en</span><span class="p">):</span>
            <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Adder</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">In</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">In</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">o</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">elaborate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>
        <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
<section id="running-a-simulation">
<h3>Running a simulation<a class="headerlink" href="#running-a-simulation" title="Link to this heading"></a></h3>
<p>Simulating a design always requires the three basic steps: constructing the <abbr title="Design Under Test">DUT</abbr>, constructing a <a class="reference internal" href="#amaranth.sim.Simulator" title="amaranth.sim.Simulator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Simulator</span></code></a> for it, and running the simulation with the <a class="reference internal" href="#amaranth.sim.Simulator.run" title="amaranth.sim.Simulator.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.run()</span></code></a> or <a class="reference internal" href="#amaranth.sim.Simulator.run_until" title="amaranth.sim.Simulator.run_until"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.run_until()</span></code></a> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">amaranth.sim</span><span class="w"> </span><span class="kn">import</span> <span class="n">Simulator</span>

<span class="n">dut</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">dut</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>However, the code above neither stimulates the DUT’s inputs nor measures the DUT’s outputs; the <a class="reference internal" href="#amaranth.sim.Simulator.run" title="amaranth.sim.Simulator.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.run()</span></code></a> method also immediately returns if no stimulus is added to the simulation. To make it useful, several changes are necessary:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="#amaranth.sim.Simulator.add_clock" title="amaranth.sim.Simulator.add_clock"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.add_clock()</span></code></a> method adds a <em>stimulus</em>: a process external to the DUT that manipulates its inputs (in this case, toggles the clock of the <code class="docutils literal notranslate"><span class="pre">sync</span></code> domain).</p></li>
<li><p>The <a class="reference internal" href="#amaranth.sim.Simulator.run_until" title="amaranth.sim.Simulator.run_until"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.run_until()</span></code></a> method runs the simulation until a specific deadline is reached.</p></li>
<li><p>The <a class="reference internal" href="#amaranth.sim.Simulator.write_vcd" title="amaranth.sim.Simulator.write_vcd"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.write_vcd()</span></code></a> method captures the DUT’s inputs, state, and outputs, and writes it to a <abbr title="Value Change Dump">VCD</abbr> file.</p></li>
</ul>
<p>The following code simulates a design and capture the values of all the signals used in the design for each moment of simulation time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dut</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">dut</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_clock</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span> <span class="c1"># 1 µs period, or 1 MHz</span>
<span class="k">with</span> <span class="n">sim</span><span class="o">.</span><span class="n">write_vcd</span><span class="p">(</span><span class="s2">&quot;example1.vcd&quot;</span><span class="p">):</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run_until</span><span class="p">(</span><span class="mf">1e-6</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span> <span class="c1"># 15 periods of the clock</span>
</pre></div>
</div>
<p>The captured data is saved to a <abbr>VCD</abbr> file <code class="file docutils literal notranslate"><span class="pre">example1.vcd</span></code>, which can be displayed with a <em>waveform viewer</em> such as <a class="reference external" href="https://surfer-project.org/">Surfer</a> or <a class="reference external" href="https://gtkwave.sourceforge.net/">GTKWave</a>:</p>
<img src="_images/simulator/example1.svg" class="wavedrom wavedrom-signal" alt="{'head': {'tock': 0}, 'signal': [{'name': 'clk', 'wave': 'lp..............'}, {'name': 'rst', 'wave': 'l...............'}, {'name': 'en', 'wave': 'h...............'}, {'name': 'count', 'wave': '================', 'data': ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15']}], 'config': {'skin': 'default'}}"><p>The <a class="reference internal" href="#amaranth.sim.Simulator.reset" title="amaranth.sim.Simulator.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.reset()</span></code></a> method reverts the simulation to its initial state. It can be used to speed up tests by capturing the waveforms only when the simulation is known to encounter an error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">sim</span><span class="o">.</span><span class="n">write_vcd</span><span class="p">(</span><span class="s2">&quot;example1_error.vcd&quot;</span><span class="p">):</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="testing-synchronous-circuits">
<h3>Testing synchronous circuits<a class="headerlink" href="#testing-synchronous-circuits" title="Link to this heading"></a></h3>
<p>To verify that the DUT works as intended during a simulation, known values are provided as the inputs, and the outputs are compared with the expected results.</p>
<p>This is done by adding a different type of stimulus to the simulator, a <em>testbench</em>: an <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span></code> Python function that runs concurrently with the DUT and can manipulate the signals used in the simulation. A testbench is added using the <a class="reference internal" href="#amaranth.sim.Simulator.add_testbench" title="amaranth.sim.Simulator.add_testbench"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.add_testbench()</span></code></a> method, and receives a <a class="reference internal" href="#amaranth.sim.SimulatorContext" title="amaranth.sim.SimulatorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimulatorContext</span></code></a> object through which it can interact with the simulator: inspect the value of signals using the <a class="reference internal" href="#amaranth.sim.SimulatorContext.get" title="amaranth.sim.SimulatorContext.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctx.get()</span></code></a> method, change the value of signals using the <a class="reference internal" href="#amaranth.sim.SimulatorContext.set" title="amaranth.sim.SimulatorContext.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctx.set()</span></code></a> method, or wait for an active edge of a <a class="reference internal" href="guide.html#lang-clockdomains"><span class="std std-ref">clock domain</span></a> using the <a class="reference internal" href="#amaranth.sim.SimulatorContext.tick" title="amaranth.sim.SimulatorContext.tick"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctx.tick()</span></code></a> method.</p>
<p>The following example simulates a counter and verifies that it can be stopped using its <code class="code highlight py python docutils literal highlight-python"><span class="n">en</span></code> input:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dut</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testbench_example2</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>     <span class="c1"># wait until after the 5th edge of the `sync` domain clock</span>
    <span class="k">assert</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span> <span class="c1"># verify that the counter has the expected value</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">en</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>         <span class="c1"># deassert `dut.en`, disabling the counter</span>
    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>     <span class="c1"># wait until after the 10th edge of clock</span>
    <span class="k">assert</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span> <span class="c1"># verify that the counter has not been incrementing</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">en</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>          <span class="c1"># assert `dut.en`, enabling the counter again</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">dut</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_clock</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_testbench</span><span class="p">(</span><span class="n">testbench_example2</span><span class="p">)</span> <span class="c1"># add the testbench; run_until() calls the function</span>
<span class="k">with</span> <span class="n">sim</span><span class="o">.</span><span class="n">write_vcd</span><span class="p">(</span><span class="s2">&quot;example2.vcd&quot;</span><span class="p">):</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run_until</span><span class="p">(</span><span class="mf">1e-6</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<p>Since this circuit is synchronous, and the <a class="reference internal" href="#amaranth.sim.SimulatorContext.tick" title="amaranth.sim.SimulatorContext.tick"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctx.tick()</span></code></a> method waits until after the circuit has reacted to the clock edge, the change to the <code class="code highlight py python docutils literal highlight-python"><span class="n">en</span></code> input affects the behavior of the circuit on the next clock cycle after the change:</p>
<img src="_images/simulator/example2.svg" class="wavedrom wavedrom-signal" alt="{'head': {'tock': 0}, 'signal': [{'name': 'clk', 'wave': 'lp..............'}, {'name': 'rst', 'wave': 'l...............'}, {'name': 'en', 'wave': 'h....0....1.....'}, {'name': 'count', 'wave': '======.....=====', 'data': ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10']}], 'config': {'skin': 'default'}}"></section>
<section id="testing-combinational-circuits">
<h3>Testing combinational circuits<a class="headerlink" href="#testing-combinational-circuits" title="Link to this heading"></a></h3>
<p>A testbench that tests a combinational circuit advances simulation time using the <a class="reference internal" href="#amaranth.sim.SimulatorContext.delay" title="amaranth.sim.SimulatorContext.delay"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctx.delay()</span></code></a> method instead of the <a class="reference internal" href="#amaranth.sim.SimulatorContext.tick" title="amaranth.sim.SimulatorContext.tick"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctx.tick()</span></code></a> method, since the simulation does not contain a clock in this case. The <a class="reference internal" href="#amaranth.sim.Simulator.run" title="amaranth.sim.Simulator.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.run()</span></code></a> method stops the simulation and returns once all testbenches finish executing.</p>
<p>The following example simulates an adder:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dut</span> <span class="o">=</span> <span class="n">Adder</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testbench_example3</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">o</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>

    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1717</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">420</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">o</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2137</span>

    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mf">2e-6</span><span class="p">)</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">dut</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_testbench</span><span class="p">(</span><span class="n">testbench_example3</span><span class="p">)</span>
<span class="k">with</span> <span class="n">sim</span><span class="o">.</span><span class="n">write_vcd</span><span class="p">(</span><span class="s2">&quot;example3.vcd&quot;</span><span class="p">):</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Since this circuit is entirely combinational, and the Amaranth simulator uses a <em>zero-delay model</em> of combinational circuits, the outputs change in the same instant as the inputs do:</p>
<img src="_images/simulator/example3.svg" class="wavedrom wavedrom-signal" alt="{'signal': [{'name': 'a', 'wave': '===.', 'data': [0, 2, 1717]}, {'name': 'b', 'wave': '===.', 'data': [0, 2, 420]}, {'name': 'o', 'wave': '===.', 'data': [0, 4, 2137]}], 'config': {'skin': 'default'}}"></section>
</section>
<section id="replacing-circuits-with-code">
<h2>Replacing circuits with code<a class="headerlink" href="#replacing-circuits-with-code" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section describes an advanced technique that is not commonly used. If you are first learning how to use the simulator, you can skip it.</p>
</div>
<p>During simulation, it is possible to replace an Amaranth circuit with the equivalent Python code. This can be used to improve simulation performance, or to avoid reimplementing complex Python algorithms in Amaranth if they do not need to be synthesized.</p>
<p>This is done by adding a <em>process</em> to the simulator: an <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span></code> Python function that runs as an integral part of the simulation, simultaneously with the DUT. A process is added using the <a class="reference internal" href="#amaranth.sim.Simulator.add_process" title="amaranth.sim.Simulator.add_process"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.add_process()</span></code></a> method, and receives a <a class="reference internal" href="#amaranth.sim.SimulatorContext" title="amaranth.sim.SimulatorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimulatorContext</span></code></a> object through which it can interact with the simulator. A process is conceptually similar to a testbench but differs from it in two important ways:</p>
<ul class="simple">
<li><p>Testbenches run in a well-defined order (from first to last in the order they were added, yielding control only at <code class="code highlight py python docutils literal highlight-python"><span class="k">await</span></code> points) and cannot observe inconsistent intermediate states of a design, but processes run in an undefined order while the design is converging after a change to its inputs.</p></li>
<li><p>In a process, it is not possible to inspect the value of a signal using the <a class="reference internal" href="#amaranth.sim.SimulatorContext.get" title="amaranth.sim.SimulatorContext.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctx.get()</span></code></a> method, which guarantees that inconsistent intermediate states of a design cannot be observed by a process either.</p></li>
</ul>
<p>A process communicates with the rest of the design in the same way an elaboratable would: through <code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code>s.</p>
<section id="replacing-synchronous-circuits">
<h3>Replacing synchronous circuits<a class="headerlink" href="#replacing-synchronous-circuits" title="Link to this heading"></a></h3>
<p>Processes cannot inspect values of signals using the <a class="reference internal" href="#amaranth.sim.SimulatorContext.get" title="amaranth.sim.SimulatorContext.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctx.get()</span></code></a> method. Instead, values of signals in a synchronous process are sampled at each active edge of the clock domain (or, for domains with asynchronous reset, at the assertion of the reset signal) using the <a class="reference internal" href="#amaranth.sim.SimulatorContext.tick" title="amaranth.sim.SimulatorContext.tick"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctx.tick()</span></code></a> method.</p>
<p>The following code replaces the <code class="code highlight py python docutils literal highlight-python"><span class="n">Counter</span></code> elaboratable with the equivalent Python code in a process, and uses a testbench to verify its correct operation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">sync</span> <span class="o">=</span> <span class="n">cd_sync</span> <span class="o">=</span> <span class="n">ClockDomain</span><span class="p">()</span>
<span class="n">en</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_example4</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="n">count_value</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># initialize counter to 0</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">clk_edge</span><span class="p">,</span> <span class="n">rst_value</span><span class="p">,</span> <span class="n">en_value</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">en</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">rst_value</span><span class="p">:</span> <span class="c1"># can be asserted with or without clk_edge</span>
            <span class="n">count_value</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># re-initialize counter</span>
        <span class="k">elif</span> <span class="n">clk_edge</span> <span class="ow">and</span> <span class="n">en_value</span><span class="p">:</span>
            <span class="n">count_value</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># advance the counter</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count_value</span><span class="p">)</span> <span class="c1"># publish its value to the simulation</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testbench_example4</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">en</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">en</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_clock</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_process</span><span class="p">(</span><span class="n">process_example4</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_testbench</span><span class="p">(</span><span class="n">testbench_example4</span><span class="p">)</span>
<span class="k">with</span> <span class="n">sim</span><span class="o">.</span><span class="n">write_vcd</span><span class="p">(</span><span class="s2">&quot;example4.vcd&quot;</span><span class="p">,</span> <span class="n">traces</span><span class="o">=</span><span class="p">(</span><span class="n">cd_sync</span><span class="o">.</span><span class="n">clk</span><span class="p">,</span> <span class="n">cd_sync</span><span class="o">.</span><span class="n">rst</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="n">count</span><span class="p">)):</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Unless it is instructed otherwise, the <a class="reference internal" href="#amaranth.sim.Simulator.write_vcd" title="amaranth.sim.Simulator.write_vcd"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.write_vcd()</span></code></a> method only captures values of signals that appear in the circuit provided to the simulator when it is created. The <code class="code highlight py python docutils literal highlight-python"><span class="n">en</span></code> and <code class="code highlight py python docutils literal highlight-python"><span class="n">count</span></code> signals do not, and are added explicitly using the <code class="code highlight py python docutils literal highlight-python"><span class="n">traces</span></code> argument so that they will appear in the VCD file.</p>
</section>
<section id="replacing-combinational-circuits">
<h3>Replacing combinational circuits<a class="headerlink" href="#replacing-combinational-circuits" title="Link to this heading"></a></h3>
<p>Values of signals in a combinational process are sampled anytime they change using the <a class="reference internal" href="#amaranth.sim.SimulatorContext.changed" title="amaranth.sim.SimulatorContext.changed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctx.changed()</span></code></a> method.</p>
<p>The following code replaces the <code class="code highlight py python docutils literal highlight-python"><span class="n">Adder</span></code> elaboratable with the equivalent Python code in a process, and uses a testbench to verify its correct operation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_example5</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">a_value</span><span class="p">,</span> <span class="n">b_value</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">changed</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">a_value</span> <span class="o">+</span> <span class="n">b_value</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testbench_example5</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>

    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1717</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">420</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2137</span>

    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mf">2e-6</span><span class="p">)</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_process</span><span class="p">(</span><span class="n">process_example5</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_testbench</span><span class="p">(</span><span class="n">testbench_example5</span><span class="p">)</span>
<span class="k">with</span> <span class="n">sim</span><span class="o">.</span><span class="n">write_vcd</span><span class="p">(</span><span class="s2">&quot;example5.vcd&quot;</span><span class="p">,</span> <span class="n">traces</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">o</span><span class="p">]):</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="amaranth.sim.Simulator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth.sim.</span></span><span class="sig-name descname"><span class="pre">Simulator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">toplevel</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.Simulator" title="Link to this definition"></a></dt>
<dd><p>Simulator for Amaranth designs.</p>
<p>The simulator accepts a <em>top-level design</em> (an <a class="reference internal" href="guide.html#lang-elaboration"><span class="std std-ref">elaboratable</span></a>),
<em>processes</em> that replace circuits with behavioral code, <em>clocks</em> that drive clock domains, and
<em>testbenches</em> that exercise the circuits and verify that they work correctly.</p>
<p>The simulator lifecycle consists of four stages:</p>
<ol class="arabic">
<li><p>The simulator is created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">design</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Processes, clocks, and testbenches are added as necessary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">add_clock</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_clock</span><span class="p">(</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;fast&quot;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_process</span><span class="p">(</span><span class="n">process_instr_decoder</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_testbench</span><span class="p">(</span><span class="n">testbench_cpu_execute</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>The simulation is run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">sim</span><span class="o">.</span><span class="n">write_vcd</span><span class="p">(</span><span class="s2">&quot;waveform.vcd&quot;</span><span class="p">):</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>(Optional) The simulator is reset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
<p>After the simulator is reset, it may be reused to run the simulation again.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Resetting the simulator can also be used to amortize the startup cost of repeatedly
simulating a large design.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>toplevel</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Elaboratable</span></code>) – Simulated design.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.Simulator.add_clock">
<span class="sig-name descname"><span class="pre">add_clock</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">period</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">domain</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sync'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">if_exists</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.Simulator.add_clock" title="Link to this definition"></a></dt>
<dd><p>Add a clock to the simulation.</p>
<p>Adds a stimulus that toggles the clock signal of <code class="code highlight py python docutils literal highlight-python"><span class="n">domain</span></code> at a 50% duty cycle.</p>
<p>The driven clock signal will toggle every half-<code class="code highlight py python docutils literal highlight-python"><span class="n">period</span></code> seconds starting at <code class="code highlight py python docutils literal highlight-python"><span class="n">phase</span></code>
seconds after the beginning of the simulation; if not specified, <code class="code highlight py python docutils literal highlight-python"><span class="n">phase</span></code> defaults to
half-<code class="code highlight py python docutils literal highlight-python"><span class="n">period</span></code> to avoid coinciding the first active edge with the beginning of
the simulation.</p>
<p>The clock domain to drive is selected by the <code class="code highlight py python docutils literal highlight-python"><span class="n">domain</span></code> argument, which may be
a <code class="xref py py-class docutils literal notranslate"><span class="pre">ClockDomain</span></code> object or a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>. If it is a string,
the clock domain with that name is retrieved from the <code class="code highlight py python docutils literal highlight-python"><span class="n">toplevel</span></code> elaboratable.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#NameError" title="(in Python v3.14)"><strong>NameError</strong></a> – If <code class="code highlight py python docutils literal highlight-python"><span class="n">domain</span></code> is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, the <code class="code highlight py python docutils literal highlight-python"><span class="n">toplevel</span></code> elaboratable does not have
    a clock domain with that name, and <code class="code highlight py python docutils literal highlight-python"><span class="n">if_exists</span></code> is <code class="code highlight py python docutils literal highlight-python"><span class="kc">False</span></code>.</p></li>
<li><p><strong>DriverConflict</strong> – If <code class="code highlight py python docutils literal highlight-python"><span class="n">domain</span></code> already has a clock driving it.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.14)"><strong>RuntimeError</strong></a> – If the simulation has been advanced since its creation or last reset.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.Simulator.add_testbench">
<span class="sig-name descname"><span class="pre">add_testbench</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">constructor</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">background</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.Simulator.add_testbench" title="Link to this definition"></a></dt>
<dd><p>Add a testbench to the simulation.</p>
<p>Adds a testbench that runs concurrently with the <code class="code highlight py python docutils literal highlight-python"><span class="n">toplevel</span></code> elaboratable and is able to
manipulate its inputs, outputs, and state.</p>
<p>The behavior of the testbench is defined by its <em>constructor function</em>, which is
an <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span></code> function that takes a single argument, the <a class="reference internal" href="#amaranth.sim.SimulatorContext" title="amaranth.sim.SimulatorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimulatorContext</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testbench</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>
    <span class="o">...</span>

<span class="n">sim</span><span class="o">.</span><span class="n">add_testbench</span><span class="p">(</span><span class="n">testbench</span><span class="p">)</span>
</pre></div>
</div>
<p>This method does not accept coroutines. Rather, the provided <code class="code highlight py python docutils literal highlight-python"><span class="n">constructor</span></code> coroutine
function is called immediately when the testbench is added to create a coroutine, as well as
by the <a class="reference internal" href="#amaranth.sim.Simulator.reset" title="amaranth.sim.Simulator.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code></a> method.</p>
<p>The testbench can be <em>critical</em> (the default) or <em>background</em> (if the <code class="code highlight py python docutils literal highlight-python"><span class="n">background</span><span class="o">=</span><span class="kc">True</span></code>
argument is specified). The <a class="reference internal" href="#amaranth.sim.Simulator.run" title="amaranth.sim.Simulator.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> method will continue advancing the simulation while
any critical testbenches or processes are running, and will exit when only background
testbenches or processes remain. A background testbench can temporarily become critical
using the <a class="reference internal" href="#amaranth.sim.SimulatorContext.critical" title="amaranth.sim.SimulatorContext.critical"><code class="xref py py-meth docutils literal notranslate"><span class="pre">critical()</span></code></a> context manager.</p>
<p>At each point in time, all of the non-waiting testbenches are executed in the order in
which they were added. If two testbenches share state, or must manipulate the design in
a coordinated way, they may rely on this execution order for correctness.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.14)"><strong>RuntimeError</strong></a> – If the simulation has been advanced since its creation or last reset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.Simulator.add_process">
<span class="sig-name descname"><span class="pre">add_process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">process</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.Simulator.add_process" title="Link to this definition"></a></dt>
<dd><p>Add a process to the simulation.</p>
<p>Adds a process that is evaluated as a part of the <code class="code highlight py python docutils literal highlight-python"><span class="n">toplevel</span></code> elaboratable and is able to
replace circuits with Python code.</p>
<p>The behavior of the process is defined by its <em>constructor function</em>, which is
an <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span></code> function that takes a single argument, the <a class="reference internal" href="#amaranth.sim.SimulatorContext" title="amaranth.sim.SimulatorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimulatorContext</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">clk_edge</span><span class="p">,</span> <span class="n">rst</span><span class="p">,</span> <span class="o">...</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="o">...</span>

<span class="n">sim</span><span class="o">.</span><span class="n">add_process</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
</pre></div>
</div>
<p>This method does not accept coroutines. Rather, the provided <code class="code highlight py python docutils literal highlight-python"><span class="n">constructor</span></code> coroutine
function is called immediately when the procss is added to create a coroutine, as well as
by the <a class="reference internal" href="#amaranth.sim.Simulator.reset" title="amaranth.sim.Simulator.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code></a> method.</p>
<p>Processes can be <em>critical</em> or <em>background</em>, and are always background when added.
The <a class="reference internal" href="#amaranth.sim.Simulator.run" title="amaranth.sim.Simulator.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> method will continue advancing the simulation while any critical testbenches
or processes are running, and will exit when only background testbenches or processes
remain. A background process can temporarily become critical using
the <a class="reference internal" href="#amaranth.sim.SimulatorContext.critical" title="amaranth.sim.SimulatorContext.critical"><code class="xref py py-meth docutils literal notranslate"><span class="pre">critical()</span></code></a> context manager.</p>
<p>At each point in time, all of the non-waiting processes are executed in an arbitrary order
that may be different between individual simulation runs.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If two processes share state, they must do so in a way that does not rely on
a particular order of execution for correctness.</p>
<p>Preferably, the shared state would be stored in <code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code>s (even
if it is not intended to be a part of a circuit), with access to it synchronized using
<code class="code highlight py python docutils literal highlight-python"><span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="o">...</span><span class="p">)</span></code>. Such state is visible in a waveform viewer,
simplifying debugging.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.14)"><strong>RuntimeError</strong></a> – If the simulation has been advanced since its creation or last reset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.Simulator.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.Simulator.run" title="Link to this definition"></a></dt>
<dd><p>Run the simulation indefinitely.</p>
<p>This method advances the simulation while any critical testbenches or processes continue
executing. It is equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">advance</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.Simulator.run_until">
<span class="sig-name descname"><span class="pre">run_until</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">deadline</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.Simulator.run_until" title="Link to this definition"></a></dt>
<dd><p>Run the simulation until a specific point in time.</p>
<p>This method advances the simulation until the simulation time reaches <code class="code highlight py python docutils literal highlight-python"><span class="n">deadline</span></code>,
without regard for whether there are critical testbenches or processes executing.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.Simulator.advance">
<span class="sig-name descname"><span class="pre">advance</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.Simulator.advance" title="Link to this definition"></a></dt>
<dd><p>Advance the simulation.</p>
<p>This method advances the simulation by one time step. After this method completes, all of
the events scheduled for the current point in time will have taken effect, and the current
point in time was advanced to the closest point in the future for which any events are
scheduled (which may be the same point in time).</p>
<p>The non-waiting testbenches are executed in the order they were added, and the processes
are executed as necessary.</p>
<p>Returns <code class="code highlight py python docutils literal highlight-python"><span class="kc">True</span></code> if the simulation contains any critical testbenches or processes, and
<code class="code highlight py python docutils literal highlight-python"><span class="kc">False</span></code> otherwise.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.Simulator.write_vcd">
<span class="sig-name descname"><span class="pre">write_vcd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vcd_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gtkw_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.Simulator.write_vcd" title="Link to this definition"></a></dt>
<dd><p>Capture waveforms to a file.</p>
<p>This context manager captures waveforms for each signal and memory that is referenced from
<code class="code highlight py python docutils literal highlight-python"><span class="n">toplevel</span></code>, as well as any additional signals or memories specified in <code class="code highlight py python docutils literal highlight-python"><span class="n">traces</span></code>,
and saves them to <code class="code highlight py python docutils literal highlight-python"><span class="n">vcd_file</span></code>. If <code class="code highlight py python docutils literal highlight-python"><span class="n">gtkw_file</span></code> is provided, it is populated with
a GTKWave save file displaying <code class="code highlight py python docutils literal highlight-python"><span class="n">traces</span></code> when opened.</p>
<p>Use this context manager to wrap a call to <a class="reference internal" href="#amaranth.sim.Simulator.run" title="amaranth.sim.Simulator.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> or <a class="reference internal" href="#amaranth.sim.Simulator.run_until" title="amaranth.sim.Simulator.run_until"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run_until()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">sim</span><span class="o">.</span><span class="n">write_vcd</span><span class="p">(</span><span class="s2">&quot;simulation.vcd&quot;</span><span class="p">):</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="code highlight py python docutils literal highlight-python"><span class="n">vcd_file</span></code> and <code class="code highlight py python docutils literal highlight-python"><span class="n">gtkw_file</span></code> arguments accept either a <a class="reference external" href="https://docs.python.org/3/glossary.html#term-file-object" title="(in Python v3.14)"><span>file object</span></a>
or a filename. If a file object is provided, it is closed when exiting the context manager
(once the simulation completes or encounters an error).</p>
<p>The <code class="code highlight py python docutils literal highlight-python"><span class="n">traces</span></code> argument accepts a <em>trace specification</em>, which can be one of:</p>
<ul class="simple">
<li><p>A <a class="reference internal" href="reference.html#amaranth.hdl.ValueLike" title="amaranth.hdl.ValueLike"><code class="xref py py-class docutils literal notranslate"><span class="pre">ValueLike</span></code></a> object, such as a <code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code>;</p></li>
<li><p>A <a class="reference internal" href="stdlib/memory.html#amaranth.hdl.MemoryData" title="amaranth.hdl.MemoryData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryData</span></code></a> object or an individual row retrieved from one;</p></li>
<li><p>A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> containing trace specifications;</p></li>
<li><p>A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> associating <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> names to trace specifications;</p></li>
<li><p>An <a class="reference internal" href="stdlib/wiring.html#wiring"><span class="std std-ref">interface object</span></a>.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.14)"><strong>TypeError</strong></a> – If a trace specification refers to a signal with a private name.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.Simulator.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.Simulator.reset" title="Link to this definition"></a></dt>
<dd><p>Reset the simulation.</p>
<p>This method reverts the simulation to its initial state:</p>
<ul class="simple">
<li><p>The value of each signal is changed to its initial value;</p></li>
<li><p>The contents of each memory is changed to its initial contents;</p></li>
<li><p>Each clock, testbench, and process is restarted.</p></li>
</ul>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="amaranth.sim.SimulatorContext">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth.sim.</span></span><span class="sig-name descname"><span class="pre">SimulatorContext</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">...</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.SimulatorContext" title="Link to this definition"></a></dt>
<dd><p>Simulator context.</p>
<p>Simulator processes and testbenches are <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span></code> Python functions that interact with
the simulation using the only argument they receive: the <em>context</em>. Using a context, it is
possible to sample or update signals and wait for events to occur in the simulation.</p>
<p>The context has two kinds of methods: <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span></code> methods and non-<code class="code highlight py python docutils literal highlight-python"><span class="k">async</span></code> methods. Calling
an <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span></code> method may cause the caller to be preempted (be paused such that the simulation
time can advance), while calling non-<code class="code highlight py python docutils literal highlight-python"><span class="k">async</span></code> methods never causes that.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While a testbench or process is executing without calling <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span></code> methods, no other
testbench or process will run, with one exception: if a testbench calls <a class="reference internal" href="#amaranth.sim.SimulatorContext.set" title="amaranth.sim.SimulatorContext.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a>, all
processes that wait (directly or indirectly) for the updated signals to change will execute
before the call returns.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>engine</strong> (<em>BaseEngine</em>)</p></li>
<li><p><strong>process</strong> (<em>BaseProcess</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.SimulatorContext.get">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="reference.html#amaranth.hdl.Value" title="amaranth.hdl._ast.Value"><span class="pre">Value</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></span><a class="headerlink" href="#amaranth.sim.SimulatorContext.get" title="Link to this definition"></a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="reference.html#amaranth.hdl.ValueCastable" title="amaranth.hdl._ast.ValueCastable"><span class="pre">ValueCastable</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.14)"><span class="pre">Any</span></a></span></span></dt>
<dd><p>Sample the value of an expression.</p>
<p>The behavior of this method depends on the type of <code class="code highlight py python docutils literal highlight-python"><span class="n">expr</span></code>:</p>
<ul class="simple">
<li><p>If it is a <a class="reference internal" href="reference.html#amaranth.hdl.ValueCastable" title="amaranth.hdl.ValueCastable"><code class="xref py py-class docutils literal notranslate"><span class="pre">ValueCastable</span></code></a> whose shape is a <a class="reference internal" href="reference.html#amaranth.hdl.ShapeCastable" title="amaranth.hdl.ShapeCastable"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeCastable</span></code></a>,
its numeric value is converted to a higher-level representation using
<a class="reference internal" href="reference.html#amaranth.hdl.ShapeCastable.from_bits" title="amaranth.hdl.ShapeCastable.from_bits"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_bits()</span></code></a> and then returned.</p></li>
<li><p>If it is a <a class="reference internal" href="reference.html#amaranth.hdl.Value" title="amaranth.hdl.Value"><code class="xref py py-class docutils literal notranslate"><span class="pre">Value</span></code></a> or a <a class="reference internal" href="reference.html#amaranth.hdl.ValueCastable" title="amaranth.hdl.ValueCastable"><code class="xref py py-class docutils literal notranslate"><span class="pre">ValueCastable</span></code></a> whose shape is
a <a class="reference internal" href="reference.html#amaranth.hdl.Shape" title="amaranth.hdl.Shape"><code class="xref py py-class docutils literal notranslate"><span class="pre">Shape</span></code></a>, the numeric value is returned as an <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>.</p></li>
</ul>
<p>This method is only available in testbenches.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.14)"><strong>TypeError</strong></a> – If the caller is a process.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.SimulatorContext.set">
<span class="sig-name descname"><span class="pre">set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="reference.html#amaranth.hdl.Value" title="amaranth.hdl._ast.Value"><span class="pre">Value</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="headerlink" href="#amaranth.sim.SimulatorContext.set" title="Link to this definition"></a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="reference.html#amaranth.hdl.ValueCastable" title="amaranth.hdl._ast.ValueCastable"><span class="pre">ValueCastable</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.14)"><span class="pre">Any</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span></dt>
<dd><p>Update the value of an expression.</p>
<p>The behavior of this method depends on the type of <code class="code highlight py python docutils literal highlight-python"><span class="n">expr</span></code>:</p>
<ul class="simple">
<li><p>If it is a <a class="reference internal" href="reference.html#amaranth.hdl.ValueCastable" title="amaranth.hdl.ValueCastable"><code class="xref py py-class docutils literal notranslate"><span class="pre">ValueCastable</span></code></a> whose shape is a <a class="reference internal" href="reference.html#amaranth.hdl.ShapeCastable" title="amaranth.hdl.ShapeCastable"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeCastable</span></code></a>,
<code class="code highlight py python docutils literal highlight-python"><span class="n">value</span></code> is converted to a numeric representation using
<a class="reference internal" href="reference.html#amaranth.hdl.ShapeCastable.const" title="amaranth.hdl.ShapeCastable.const"><code class="xref py py-meth docutils literal notranslate"><span class="pre">const()</span></code></a> and then assigned.</p></li>
<li><p>If it is a <a class="reference internal" href="reference.html#amaranth.hdl.Value" title="amaranth.hdl.Value"><code class="xref py py-class docutils literal notranslate"><span class="pre">Value</span></code></a> or a <a class="reference internal" href="reference.html#amaranth.hdl.ValueCastable" title="amaranth.hdl.ValueCastable"><code class="xref py py-class docutils literal notranslate"><span class="pre">ValueCastable</span></code></a> whose shape is
a <a class="reference internal" href="reference.html#amaranth.hdl.Shape" title="amaranth.hdl.Shape"><code class="xref py py-class docutils literal notranslate"><span class="pre">Shape</span></code></a>, <code class="code highlight py python docutils literal highlight-python"><span class="n">value</span></code> is assigned as-is.</p></li>
</ul>
<p>This method is available in both processes and testbenches.</p>
<p>When used in a testbench, this method runs all processes that wait (directly or
indirectly) for the signals in <code class="code highlight py python docutils literal highlight-python"><span class="n">expr</span></code> to change, and returns only after the change
propagates through the simulated circuits.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.SimulatorContext.critical">
<span class="sig-name descname"><span class="pre">critical</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.SimulatorContext.critical" title="Link to this definition"></a></dt>
<dd><p>Context manager that temporarily makes the caller critical.</p>
<p>Testbenches and processes may be <em>background</em> or <em>critical</em>, where critical ones prevent
<a class="reference internal" href="#amaranth.sim.Simulator.run" title="amaranth.sim.Simulator.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.run()</span></code></a> from finishing. Processes are always created background, while
testbenches are created critical by default, but may also be created background.
This context manager makes the caller critical for the span of the <code class="code highlight py python docutils literal highlight-python"><span class="k">with</span></code> statement.</p>
<p>This may be useful in cases where an operation (for example, a bus transaction) takes
multiple clock cycles to complete, and must be completed after starting, but the testbench
or process performing it never finishes, always waiting for the next operation to arrive.
In this case, the caller would elevate itself to become critical only for the duration of
the operation itself using this context manager, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testbench_bus_transaction</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="c1"># On every cycle, check whether the bus has an active transaction...</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">clk_edge</span><span class="p">,</span> <span class="n">rst_active</span><span class="p">,</span> <span class="n">bus_active_value</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">bus</span><span class="o">.</span><span class="n">active</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bus_active_value</span><span class="p">:</span> <span class="c1"># ... if it does...</span>
            <span class="k">with</span> <span class="n">ctx</span><span class="o">.</span><span class="n">critical</span><span class="p">():</span> <span class="c1"># ... make this testbench critical...</span>
                <span class="n">addr_value</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bus</span><span class="o">.</span><span class="n">r_addr</span><span class="p">)</span>
                <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">bus</span><span class="o">.</span><span class="n">r_data</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="c1"># ... perform the access...</span>
                <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>
                <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">bus</span><span class="o">.</span><span class="n">done</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>
                <span class="n">ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">bus</span><span class="o">.</span><span class="n">done</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># ... and complete the transaction later.</span>
            <span class="c1"># The `run()` method could return at this point, but not before.</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.SimulatorContext.tick">
<span class="sig-name descname"><span class="pre">tick</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">domain</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Elaboratable</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#amaranth.sim.TickTrigger" title="amaranth.sim._async.TickTrigger"><span class="pre">TickTrigger</span></a></span></span><a class="headerlink" href="#amaranth.sim.SimulatorContext.tick" title="Link to this definition"></a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">tick</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">domain</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ClockDomain</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#amaranth.sim.TickTrigger" title="amaranth.sim._async.TickTrigger"><span class="pre">TickTrigger</span></a></span></span></dt>
<dd><p>Wait until an active clock edge or an asynchronous reset occurs.</p>
<p>This method returns a <a class="reference internal" href="#amaranth.sim.TickTrigger" title="amaranth.sim.TickTrigger"><code class="xref py py-class docutils literal notranslate"><span class="pre">TickTrigger</span></code></a> object that, when awaited, pauses the execution
of the calling process or testbench until the active edge of the clock, or the asynchronous
reset (if applicable), occurs. The returned object may be used to repeatedly wait for one
of these events until a condition is satisfied or a specific number of times. See
the <a class="reference internal" href="#sim-tick-trigger"><span class="std std-ref">tick trigger reference</span></a> for more details.</p>
<p>The <code class="code highlight py python docutils literal highlight-python"><span class="n">domain</span></code> may be either a <code class="xref py py-class docutils literal notranslate"><span class="pre">ClockDomain</span></code> or a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>. If it is
a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, a clock domain with this name is looked up in
the <a class="reference internal" href="guide.html#lang-elaboration"><span class="std std-ref">elaboratable</span></a> <code class="code highlight py python docutils literal highlight-python"><span class="n">context</span></code>, or in <code class="code highlight py python docutils literal highlight-python"><span class="n">toplevel</span></code> if
<code class="code highlight py python docutils literal highlight-python"><span class="n">context</span></code> is not provided.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If <code class="code highlight py python docutils literal highlight-python"><span class="n">domain</span></code> is <code class="code highlight py python docutils literal highlight-python"><span class="s2">&quot;comb&quot;</span></code>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If <code class="code highlight py python docutils literal highlight-python"><span class="n">domain</span></code> is a <code class="xref py py-class docutils literal notranslate"><span class="pre">ClockDomain</span></code> and <code class="code highlight py python docutils literal highlight-python"><span class="n">context</span></code> is provided and not
    <code class="code highlight py python docutils literal highlight-python"><span class="kc">None</span></code>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If <code class="code highlight py python docutils literal highlight-python"><span class="n">context</span></code> is an elaboratable that is not a direct or indirect submodule of
    <code class="code highlight py python docutils literal highlight-python"><span class="n">toplevel</span></code>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#NameError" title="(in Python v3.14)"><strong>NameError</strong></a> – If <code class="code highlight py python docutils literal highlight-python"><span class="n">domain</span></code> is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, but there is no clock domain with this name in
    <code class="code highlight py python docutils literal highlight-python"><span class="n">context</span></code> or <code class="code highlight py python docutils literal highlight-python"><span class="n">toplevel</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.SimulatorContext.delay">
<span class="sig-name descname"><span class="pre">delay</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">interval</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.SimulatorContext.delay" title="Link to this definition"></a></dt>
<dd><p>Wait until a time interval has elapsed.</p>
<p>This method returns a <a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim.TriggerCombination"><code class="xref py py-class docutils literal notranslate"><span class="pre">TriggerCombination</span></code></a> object that, when awaited, pauses
the execution of the calling process or testbench by <code class="code highlight py python docutils literal highlight-python"><span class="n">interval</span></code> seconds. The returned
object may be used to wait for multiple events.</p>
<p>The value captured by this trigger is <code class="code highlight py python docutils literal highlight-python"><span class="kc">True</span></code> if the delay has expired when the wait has
completed, and <code class="code highlight py python docutils literal highlight-python"><span class="kc">False</span></code> otherwise.</p>
<p>The <code class="code highlight py python docutils literal highlight-python"><span class="n">interval</span></code> may be zero, in which case the caller will be scheduled for execution
immediately after all of the processes and testbenches scheduled for the current time step
finish executing. In other words, if a call to <a class="reference internal" href="#amaranth.sim.Simulator.advance" title="amaranth.sim.Simulator.advance"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.advance()</span></code></a> schedules a process
or testbench and it performs <code class="code highlight py python docutils literal highlight-python"><span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></code>, this process or testbench will
continue execution only during the next call to <a class="reference internal" href="#amaranth.sim.Simulator.advance" title="amaranth.sim.Simulator.advance"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.advance()</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the behavior of <code class="code highlight py python docutils literal highlight-python"><span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></code> is well-defined, it may make waveforms
difficult to understand and simulations hard to reason about.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If <code class="code highlight py python docutils literal highlight-python"><span class="n">delay</span></code> is negative.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim._async.TriggerCombination"><em>TriggerCombination</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.SimulatorContext.changed">
<span class="sig-name descname"><span class="pre">changed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">signals</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.SimulatorContext.changed" title="Link to this definition"></a></dt>
<dd><p>Asynchronously wait until one of the signals change.</p>
<p>This method returns a <a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim.TriggerCombination"><code class="xref py py-class docutils literal notranslate"><span class="pre">TriggerCombination</span></code></a> object that, when awaited, pauses
the execution of the calling process or testbench until any of the <code class="code highlight py python docutils literal highlight-python"><span class="n">signals</span></code> change.
The returned object may be used to wait for multiple events.</p>
<p>The values captured by this trigger are the values of <code class="code highlight py python docutils literal highlight-python"><span class="n">signals</span></code> at the time the wait
has completed.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The simulation may produce <em>glitches</em>: transient changes to signals (e.g. from 0 to 1
and back to 0) during combinational propagation that are invisible in testbenches or
waveform captures. Glitches will wake up <strong>both processes and testbenches</strong> that use
this method to wait for a signal to change, and both processes and testbenches must be
prepared to handle such spurious wakeups. The presence, count, and sequence in which
glitches occur may also vary between simulation runs.</p>
<p>Testbenches that wait for a signal to change using an <code class="code highlight py python docutils literal highlight-python"><span class="k">await</span></code> statement might only
observe the final value of the signal, and testbenches that wait for changes using
an <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span> <span class="k">for</span></code> loop will crash with a <a class="reference internal" href="#amaranth.sim.BrokenTrigger" title="amaranth.sim.BrokenTrigger"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BrokenTrigger</span></code></a> exception if they
encounter a glitch.</p>
<p>Processes will observe all of the transient values of the signal.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim._async.TriggerCombination"><em>TriggerCombination</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.SimulatorContext.edge">
<span class="sig-name descname"><span class="pre">edge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">polarity</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.SimulatorContext.edge" title="Link to this definition"></a></dt>
<dd><p>Asynchronously wait until a low-to-high or high-to-low transition of a signal occurs.</p>
<p>This method returns a <a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim.TriggerCombination"><code class="xref py py-class docutils literal notranslate"><span class="pre">TriggerCombination</span></code></a> object that, when awaited, pauses
the execution of the calling process or testbench until the value of <code class="code highlight py python docutils literal highlight-python"><span class="n">signal</span></code>
(a single-bit signal or a single-bit slice of a signal) changes from <code class="code highlight py python docutils literal highlight-python"><span class="ow">not</span> <span class="n">polarity</span></code>
to <code class="code highlight py python docutils literal highlight-python"><span class="n">polarity</span></code>. The returned object may be used to wait for multiple events.</p>
<p>The value captured by this trigger is <code class="code highlight py python docutils literal highlight-python"><span class="kc">True</span></code> if the relevant transition has occurred
at the time the wait has completed, and <code class="code highlight py python docutils literal highlight-python"><span class="kc">False</span></code> otherwise.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In most cases, this method should not be used to wait for a status signal to be asserted
or deasserted in a testbench because it is likely to introduce a race condition.
Whenever a suitable clock domain is available, use
<code class="code highlight py python docutils literal highlight-python"><span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">signal</span> <span class="o">==</span> <span class="n">polarity</span><span class="p">)</span></code> instead.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.14)"><strong>TypeError</strong></a> – If <code class="code highlight py python docutils literal highlight-python"><span class="n">signal</span></code> is neither a single-bit <code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code> nor a single-bit slice of
    a <code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.14)"><strong>TypeError</strong></a> – If the shape of <code class="code highlight py python docutils literal highlight-python"><span class="n">signal</span></code> is a <code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeCastable</span></code>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If <code class="code highlight py python docutils literal highlight-python"><span class="n">polarity</span></code> is neither 0 nor 1.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim._async.TriggerCombination"><em>TriggerCombination</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.SimulatorContext.posedge">
<span class="sig-name descname"><span class="pre">posedge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.SimulatorContext.posedge" title="Link to this definition"></a></dt>
<dd><p>Asynchronously wait until a signal is asserted.</p>
<p>Equivalent to <a class="reference internal" href="#amaranth.sim.SimulatorContext.edge" title="amaranth.sim.SimulatorContext.edge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">edge(signal,</span> <span class="pre">1)</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim._async.TriggerCombination"><em>TriggerCombination</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.SimulatorContext.negedge">
<span class="sig-name descname"><span class="pre">negedge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.SimulatorContext.negedge" title="Link to this definition"></a></dt>
<dd><p>Asynchronously wait until a signal is deasserted.</p>
<p>Equivalent to <a class="reference internal" href="#amaranth.sim.SimulatorContext.edge" title="amaranth.sim.SimulatorContext.edge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">edge(signal,</span> <span class="pre">0)</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim._async.TriggerCombination"><em>TriggerCombination</em></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="amaranth.sim.BrokenTrigger">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth.sim.</span></span><span class="sig-name descname"><span class="pre">BrokenTrigger</span></span><a class="headerlink" href="#amaranth.sim.BrokenTrigger" title="Link to this definition"></a></dt>
<dd><p>Exception raised when a trigger that is repeatedly awaited using an <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span> <span class="k">for</span></code> loop has
a matching event occur while the body of the <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span> <span class="k">for</span></code> loop is still executing.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="amaranth.sim.DomainReset">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth.sim.</span></span><span class="sig-name descname"><span class="pre">DomainReset</span></span><a class="headerlink" href="#amaranth.sim.DomainReset" title="Link to this definition"></a></dt>
<dd><p>Exception raised when a tick trigger is repeatedly awaited, and its domain has been reset.</p>
</dd></dl>

<dl class="py class" id="sim-tick-trigger">
<dt class="sig sig-object py" id="amaranth.sim.TickTrigger">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth.sim.</span></span><span class="sig-name descname"><span class="pre">TickTrigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">...</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.TickTrigger" title="Link to this definition"></a></dt>
<dd><p>A trigger that wakes up the caller when the active edge of a clock domain occurs or the domain
is asynchronously reset.</p>
<p>A <a class="reference internal" href="#amaranth.sim.TickTrigger" title="amaranth.sim.TickTrigger"><code class="xref py py-class docutils literal notranslate"><span class="pre">TickTrigger</span></code></a> is an immutable object that stores a reference to a clock domain and
a list of expressions to sample.</p>
<p>The <a class="reference internal" href="#amaranth.sim.SimulatorContext.tick" title="amaranth.sim.SimulatorContext.tick"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.tick()</span></code></a> method creates a tick trigger with an empty list of sampled
expressions, and the <a class="reference internal" href="#amaranth.sim.TickTrigger.sample" title="amaranth.sim.TickTrigger.sample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TickTrigger.sample()</span></code></a> method creates a tick trigger based on another
tick trigger that additionally samples the specified expressions.</p>
<p>To wait for a tick trigger to be activated once (a <em>one-shot</em> wait), a process or testbench
calls <code class="code highlight py python docutils literal highlight-python"><span class="k">await</span> <span class="n">trigger</span></code>, usually on a newly created tick trigger:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testbench</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="n">clk_hit</span><span class="p">,</span> <span class="n">rst_active</span><span class="p">,</span> <span class="n">a_value</span><span class="p">,</span> <span class="n">b_value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">dut</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>To repeatedly wait for a tick trigger to be activated (a <em>multi-shot</em> wait), a process or
testbench <a class="reference external" href="https://docs.python.org/3/glossary.html#term-asynchronous-iterable" title="(in Python v3.14)"><span class="xref std std-term">asynchronously iterates</span></a> the tick trigger,
usually using the <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span> <span class="k">for</span></code> loop:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testbench</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">clk_hit</span><span class="p">,</span> <span class="n">rst_active</span><span class="p">,</span> <span class="n">a_value</span><span class="p">,</span> <span class="n">b_value</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">dut</span><span class="o">.</span><span class="n">b</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Both one-shot and multi-shot waits return the same <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>
<code class="code highlight py python docutils literal highlight-python"><span class="p">(</span><span class="n">clk_hit</span><span class="p">,</span> <span class="n">rst_active</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">)</span></code> of return values:</p>
<ol class="arabic simple">
<li><p><code class="code highlight py python docutils literal highlight-python"><span class="n">clk_hit</span></code> is <code class="code highlight py python docutils literal highlight-python"><span class="kc">True</span></code> if there was an active clock edge at the moment the wait has
completed, and <code class="code highlight py python docutils literal highlight-python"><span class="kc">False</span></code> otherwise (that is, if the clock domain was asynchronously reset).</p></li>
<li><p><code class="code highlight py python docutils literal highlight-python"><span class="n">rst_active</span></code> is <code class="code highlight py python docutils literal highlight-python"><span class="kc">True</span></code> if the clock domain is reset (synchronously or asynchronously)
at the moment the wait has completed, <code class="code highlight py python docutils literal highlight-python"><span class="kc">False</span></code> otherwise.</p></li>
<li><p>All following return values correspond to the sampled expressions in the order in which they
were added.</p></li>
</ol>
<p>Aside from the syntax, there are two differences between one-shot and multi-shot waits:</p>
<ol class="arabic simple">
<li><p>A multi-shot wait continues to observe the tick trigger while the process or testbench
responds to the event. If the tick trigger is activated again before the next iteration of
the asynchronous iterator (such as while the body of the <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span> <span class="k">for</span></code> loop is executing),
the next iteration raises a <a class="reference internal" href="#amaranth.sim.BrokenTrigger" title="amaranth.sim.BrokenTrigger"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BrokenTrigger</span></code></a> exception to notify the caller of the missed
event.</p></li>
<li><p>A repeated one-shot wait may be less efficient than a multi-shot wait.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The exact behavior of <code class="code highlight py python docutils literal highlight-python"><span class="n">rst_active</span></code> differs depending on whether <code class="code highlight py python docutils literal highlight-python"><span class="n">domain</span></code> uses
synchronous or asynchronous reset; in both cases it is <code class="code highlight py python docutils literal highlight-python"><span class="kc">True</span></code> if and only if
the domain reset has been asserted. Reusable processes and testbenches, as well as their
building blocks, should handle both cases.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>engine</strong> (<em>BaseEngine</em>)</p></li>
<li><p><strong>process</strong> (<em>BaseProcess</em>)</p></li>
<li><p><strong>domain</strong> (<em>ClockDomain</em>)</p></li>
<li><p><strong>sampled</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><em>tuple</em></a><em>[</em><a class="reference internal" href="reference.html#amaranth.hdl.ValueLike" title="amaranth.hdl.ValueLike"><em>ValueLike</em></a><em>]</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.TickTrigger.sample">
<span class="sig-name descname"><span class="pre">sample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">exprs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.TickTrigger.sample" title="Link to this definition"></a></dt>
<dd><p>Sample expressions when this trigger is activated.</p>
<p>This method returns a new <a class="reference internal" href="#amaranth.sim.TickTrigger" title="amaranth.sim.TickTrigger"><code class="xref py py-class docutils literal notranslate"><span class="pre">TickTrigger</span></code></a> object. When awaited, this object returns,
in addition to the values that would be otherwise returned by <code class="code highlight py python docutils literal highlight-python"><span class="k">await</span> <span class="n">trigger</span></code>,
the values of <code class="code highlight py python docutils literal highlight-python"><span class="n">exprs</span></code> (any <a class="reference internal" href="reference.html#amaranth.hdl.ValueLike" title="amaranth.hdl.ValueLike"><code class="xref py py-class docutils literal notranslate"><span class="pre">ValueLike</span></code></a>) at exactly the moment at which
the active clock edge, or the asynchronous reset (if applicable), has occurred.</p>
<p>Combining <a class="reference internal" href="#amaranth.sim.SimulatorContext.tick" title="amaranth.sim.SimulatorContext.tick"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tick()</span></code></a> with <a class="reference internal" href="#amaranth.sim.TickTrigger.sample" title="amaranth.sim.TickTrigger.sample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sample()</span></code></a> can be used to capture
the state of a circuit after the active clock edge, but before propagation of signal values
that have been updated by that clock edge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">clk_edge</span><span class="p">,</span> <span class="n">rst_active</span><span class="p">,</span> <span class="n">in_a_value</span><span class="p">,</span> <span class="n">in_b_value</span> <span class="ow">in</span> \
        <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">in_a</span><span class="p">,</span> <span class="n">in_b</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Chaining calls to <a class="reference internal" href="#amaranth.sim.TickTrigger.sample" title="amaranth.sim.TickTrigger.sample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sample()</span></code></a> has the same effect as calling it once with the combined
list of arguments. The code below has the same behavior as the code above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">clk_edge</span><span class="p">,</span> <span class="n">rst_active</span><span class="p">,</span> <span class="n">in_a_value</span><span class="p">,</span> <span class="n">in_b_value</span> <span class="ow">in</span> \
        <span class="n">ctx</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">in_a</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">in_b</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Chaining calls to this method is useful for defining reusable building blocks.
The following (simplified for clarity) implementation of <a class="reference internal" href="#amaranth.sim.TickTrigger.until" title="amaranth.sim.TickTrigger.until"><code class="xref py py-meth docutils literal notranslate"><span class="pre">until()</span></code></a> takes advantage
of it by first appending <code class="code highlight py python docutils literal highlight-python"><span class="n">condition</span></code> to the end of the list of captured expressions,
checking if it holds, and then removing it from the list of sampled values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">until</span><span class="p">(</span><span class="n">trigger</span><span class="p">,</span> <span class="n">condition</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">clk_edge</span><span class="p">,</span> <span class="n">rst_active</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="n">done</span> <span class="ow">in</span> <span class="n">trigger</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">condition</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">values</span>
</pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>exprs</strong> (<a class="reference internal" href="reference.html#amaranth.hdl.ValueLike" title="amaranth.hdl._ast.ValueLike"><em>ValueLike</em></a>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#amaranth.sim.TickTrigger" title="amaranth.sim._async.TickTrigger"><em>TickTrigger</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.TickTrigger.until">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">until</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">condition</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.TickTrigger.until" title="Link to this definition"></a></dt>
<dd><p>Repeat this trigger until a condition is met.</p>
<p>This method awaits this trigger at least once, and returns a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of the values
that are <a class="reference internal" href="#amaranth.sim.TickTrigger.sample" title="amaranth.sim.TickTrigger.sample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sample()</span></code></a>d when <code class="code highlight py python docutils literal highlight-python"><span class="n">condition</span></code> evaluates to a non-zero value. Values
sampled during previous repeats are discarded.</p>
<p>Awaiting a <code class="code highlight py python docutils literal highlight-python"><span class="n">trigger</span></code> returns values indicating the state of the clock and reset signals,
while awaiting <code class="code highlight py python docutils literal highlight-python"><span class="n">trigger</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="o">...</span><span class="p">)</span></code> does not:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">clk_edge</span><span class="p">,</span> <span class="n">rst_active</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="n">flag_value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">trigger</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="c1"># never raises</span>
    <span class="k">if</span> <span class="n">flag_value</span><span class="p">:</span>
        <span class="k">break</span>
<span class="c1"># `values` may be used after the loop finishes</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="k">await</span> <span class="n">trigger</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="c1"># may raise `DomainReset`</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.14)"><strong>TypeError</strong></a> – If the shape of <code class="code highlight py python docutils literal highlight-python"><span class="n">condition</span></code> is a <code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeCastable</span></code>.</p></li>
<li><p><a class="reference internal" href="#amaranth.sim.DomainReset" title="amaranth.sim.DomainReset"><strong>DomainReset</strong></a> – If the clock domain has been synchronously or asynchronously reset during the wait.</p></li>
</ul>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>condition</strong> (<a class="reference internal" href="reference.html#amaranth.hdl.ValueLike" title="amaranth.hdl._ast.ValueLike"><em>ValueLike</em></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.TickTrigger.repeat">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">repeat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">count</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.TickTrigger.repeat" title="Link to this definition"></a></dt>
<dd><p>Repeat this trigger a specific number of times.</p>
<p>This method awaits this trigger at least once, and returns a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of the values
that are <a class="reference internal" href="#amaranth.sim.TickTrigger.sample" title="amaranth.sim.TickTrigger.sample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sample()</span></code></a>d during the last repeat. Values sampled during previous repeats
are discarded.</p>
<p>Awaiting a <code class="code highlight py python docutils literal highlight-python"><span class="n">trigger</span></code> returns values indicating the state of the clock and reset signals,
while awaiting <code class="code highlight py python docutils literal highlight-python"><span class="n">trigger</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="o">...</span><span class="p">)</span></code> does not:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">clk_edge</span><span class="p">,</span> <span class="n">rst_active</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span> <span class="o">=</span> <span class="k">await</span> <span class="n">trigger</span> <span class="c1"># never raises</span>
<span class="c1"># `values` may be used after the loop finishes</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="k">await</span> <span class="n">trigger</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># may raise `DomainReset`</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If <code class="code highlight py python docutils literal highlight-python"><span class="n">count</span></code> is less than 1.</p></li>
<li><p><a class="reference internal" href="#amaranth.sim.DomainReset" title="amaranth.sim.DomainReset"><strong>DomainReset</strong></a> – If the clock domain has been synchronously or asynchronously reset during the wait.</p></li>
</ul>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>count</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a>)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="amaranth.sim.TriggerCombination">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">amaranth.sim.</span></span><span class="sig-name descname"><span class="pre">TriggerCombination</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">...</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.TriggerCombination" title="Link to this definition"></a></dt>
<dd><p>A list of triggers, the activation of any of which will wake up the caller.</p>
<p>A <a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim.TriggerCombination"><code class="xref py py-class docutils literal notranslate"><span class="pre">TriggerCombination</span></code></a> is an immutable object that stores a list of triggers and
expressions to sample. The trigger combination wakes up the caller when any of these triggers
activate, and it samples all of the signals at the same moment.</p>
<p>The <a class="reference internal" href="#amaranth.sim.SimulatorContext.delay" title="amaranth.sim.SimulatorContext.delay"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.delay()</span></code></a>, <a class="reference internal" href="#amaranth.sim.SimulatorContext.changed" title="amaranth.sim.SimulatorContext.changed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.changed()</span></code></a>, and
<a class="reference internal" href="#amaranth.sim.SimulatorContext.edge" title="amaranth.sim.SimulatorContext.edge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.edge()</span></code></a> methods create a trigger combination that consists of just that
one trigger, while <a class="reference internal" href="#amaranth.sim.TriggerCombination.delay" title="amaranth.sim.TriggerCombination.delay"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TriggerCombination.delay()</span></code></a>, <a class="reference internal" href="#amaranth.sim.TriggerCombination.changed" title="amaranth.sim.TriggerCombination.changed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TriggerCombination.changed()</span></code></a>, and
<a class="reference internal" href="#amaranth.sim.TriggerCombination.edge" title="amaranth.sim.TriggerCombination.edge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TriggerCombination.edge()</span></code></a> methods create a trigger combination based on another trigger
combination by extending it with an additional trigger. The <a class="reference internal" href="#amaranth.sim.TriggerCombination.sample" title="amaranth.sim.TriggerCombination.sample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TriggerCombination.sample()</span></code></a>
method creates a trigger combination based on another trigger combination that wakes up
the caller in the same conditions but additionally samples the specified expressions.</p>
<p>To wait for a trigger combination to be activated once (a <em>one-shot</em> wait), a process or
testbench calls <code class="code highlight py python docutils literal highlight-python"><span class="k">await</span> <span class="n">triggers</span></code>, usually on a newly created trigger combination:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testbench</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="n">a_value</span><span class="p">,</span> <span class="n">b_value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">changed</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">dut</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>To repeatedly wait for a trigger combination to be activated (a <em>multi-shot</em> wait), a process
or testbench <a class="reference external" href="https://docs.python.org/3/glossary.html#term-asynchronous-iterable" title="(in Python v3.14)"><span class="xref std std-term">asynchronously iterates</span></a> the trigger
combination, usually using the <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span> <span class="k">for</span></code> loop:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testbench</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">async</span> <span class="n">a_value</span><span class="p">,</span> <span class="n">b_value</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">changed</span><span class="p">(</span><span class="n">dut</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">dut</span><span class="o">.</span><span class="n">b</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Both one-shot and multi-shot waits return the same <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of return values, the elements
of which are determined by the triggers and sampled expressions that have been added to
the trigger combination, in the order in which they were added. For a detailed description of
the return values, refer to <a class="reference internal" href="#amaranth.sim.SimulatorContext.delay" title="amaranth.sim.SimulatorContext.delay"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.delay()</span></code></a>, <a class="reference internal" href="#amaranth.sim.SimulatorContext.changed" title="amaranth.sim.SimulatorContext.changed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.changed()</span></code></a>,
<a class="reference internal" href="#amaranth.sim.SimulatorContext.edge" title="amaranth.sim.SimulatorContext.edge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.edge()</span></code></a>, and <a class="reference internal" href="#amaranth.sim.TriggerCombination.sample" title="amaranth.sim.TriggerCombination.sample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TriggerCombination.sample()</span></code></a>.</p>
<p>Aside from the syntax, there are two differences between one-shot and multi-shot waits:</p>
<ol class="arabic simple">
<li><p>A multi-shot wait continues to observe the trigger combination while the process or testbench
responds to the event. If the trigger combination is activated again before the next
iteration of the asynchronous iterator (such as while the body of the <code class="code highlight py python docutils literal highlight-python"><span class="k">async</span> <span class="k">for</span></code> loop is
executing), the next iteration raises a <a class="reference internal" href="#amaranth.sim.BrokenTrigger" title="amaranth.sim.BrokenTrigger"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BrokenTrigger</span></code></a> exception to notify the caller
of the missed event.</p></li>
<li><p>A repeated one-shot wait may be less efficient than a multi-shot wait.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>engine</strong> (<em>BaseEngine</em>)</p></li>
<li><p><strong>process</strong> (<em>BaseProcess</em>)</p></li>
<li><p><strong>triggers</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><em>tuple</em></a><em>[</em><em>DelayTrigger</em><em>|</em><em>ChangedTrigger</em><em>|</em><em>SampleTrigger</em><em>|</em><em>EdgeTrigger</em><em>, </em><em>...</em><em>]</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.TriggerCombination.sample">
<span class="sig-name descname"><span class="pre">sample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">exprs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.TriggerCombination.sample" title="Link to this definition"></a></dt>
<dd><p>Sample signals when a trigger from this combination is activated.</p>
<p>This method returns a new <a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim.TriggerCombination"><code class="xref py py-class docutils literal notranslate"><span class="pre">TriggerCombination</span></code></a> object. When awaited, this object
returns, in addition to the values that would be returned by <code class="code highlight py python docutils literal highlight-python"><span class="k">await</span> <span class="n">trigger</span></code>, the values
of <code class="code highlight py python docutils literal highlight-python"><span class="n">exprs</span></code> at exactly the moment at which the wait has completed.</p>
<p>Combining <a class="reference internal" href="#amaranth.sim.SimulatorContext.delay" title="amaranth.sim.SimulatorContext.delay"><code class="xref py py-meth docutils literal notranslate"><span class="pre">delay()</span></code></a>, <a class="reference internal" href="#amaranth.sim.SimulatorContext.changed" title="amaranth.sim.SimulatorContext.changed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">changed()</span></code></a>, or
<a class="reference internal" href="#amaranth.sim.SimulatorContext.edge" title="amaranth.sim.SimulatorContext.edge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">edge()</span></code></a> with <a class="reference internal" href="#amaranth.sim.TriggerCombination.sample" title="amaranth.sim.TriggerCombination.sample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sample()</span></code></a> can be used to capture the state of
a circuit at the moment of the event:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">arst_edge</span><span class="p">,</span> <span class="n">delay_expired</span><span class="p">,</span> <span class="n">in_a_value</span><span class="p">,</span> <span class="n">in_b_value</span> <span class="ow">in</span> \
        <span class="n">ctx</span><span class="o">.</span><span class="n">posedge</span><span class="p">(</span><span class="n">arst</span><span class="p">)</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">in_a</span><span class="p">,</span> <span class="n">in_b</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Chaining calls to <a class="reference internal" href="#amaranth.sim.TriggerCombination.sample" title="amaranth.sim.TriggerCombination.sample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sample()</span></code></a> has the same effect as calling it once with the combined
list of arguments. The code below has the same behavior as the code above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">arst_edge</span><span class="p">,</span> <span class="n">delay_expired</span><span class="p">,</span> <span class="n">in_a_value</span><span class="p">,</span> <span class="n">in_b_value</span> <span class="ow">in</span> \
        <span class="n">ctx</span><span class="o">.</span><span class="n">posedge</span><span class="p">(</span><span class="n">arst</span><span class="p">)</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">in_a</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">in_b</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Chaining calls to this method is useful for defining reusable building blocks. See
the documentation for <a class="reference internal" href="#amaranth.sim.TickTrigger.sample" title="amaranth.sim.TickTrigger.sample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TickTrigger.sample()</span></code></a> for a detailed example.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim._async.TriggerCombination"><em>TriggerCombination</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.TriggerCombination.delay">
<span class="sig-name descname"><span class="pre">delay</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">interval</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.TriggerCombination.delay" title="Link to this definition"></a></dt>
<dd><p>Add a delay trigger to the list of triggers.</p>
<p>This method returns a new <a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim.TriggerCombination"><code class="xref py py-class docutils literal notranslate"><span class="pre">TriggerCombination</span></code></a> object. When awaited, this object
also waits for the same trigger as <a class="reference internal" href="#amaranth.sim.SimulatorContext.delay" title="amaranth.sim.SimulatorContext.delay"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.delay()</span></code></a>, and returns,
in addition to the values that would be returned by <code class="code highlight py python docutils literal highlight-python"><span class="k">await</span> <span class="n">trigger</span></code>, the value
returned by <a class="reference internal" href="#amaranth.sim.SimulatorContext.delay" title="amaranth.sim.SimulatorContext.delay"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.delay()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim._async.TriggerCombination"><em>TriggerCombination</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.TriggerCombination.changed">
<span class="sig-name descname"><span class="pre">changed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">signals</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.TriggerCombination.changed" title="Link to this definition"></a></dt>
<dd><p>Add a signal change trigger to the list of triggers.</p>
<p>This method returns a new <a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim.TriggerCombination"><code class="xref py py-class docutils literal notranslate"><span class="pre">TriggerCombination</span></code></a> object. When awaited, this object
also waits for the same trigger as <a class="reference internal" href="#amaranth.sim.SimulatorContext.changed" title="amaranth.sim.SimulatorContext.changed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.changed()</span></code></a>, and returns,
in addition to the values that would be returned by <code class="code highlight py python docutils literal highlight-python"><span class="k">await</span> <span class="n">trigger</span></code>, the values
returned by <a class="reference internal" href="#amaranth.sim.SimulatorContext.changed" title="amaranth.sim.SimulatorContext.changed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.changed()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim._async.TriggerCombination"><em>TriggerCombination</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.TriggerCombination.edge">
<span class="sig-name descname"><span class="pre">edge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">polarity</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.TriggerCombination.edge" title="Link to this definition"></a></dt>
<dd><p>Add a low-to-high or high-to-low transition trigger to the list of triggers.</p>
<p>This method returns a new <a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim.TriggerCombination"><code class="xref py py-class docutils literal notranslate"><span class="pre">TriggerCombination</span></code></a> object. When awaited, this object
also waits for the same trigger as <a class="reference internal" href="#amaranth.sim.SimulatorContext.edge" title="amaranth.sim.SimulatorContext.edge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.edge()</span></code></a>, and returns,
in addition to the values that would be returned by <code class="code highlight py python docutils literal highlight-python"><span class="k">await</span> <span class="n">trigger</span></code>, the values
returned by <a class="reference internal" href="#amaranth.sim.SimulatorContext.edge" title="amaranth.sim.SimulatorContext.edge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimulatorContext.edge()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim._async.TriggerCombination"><em>TriggerCombination</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.TriggerCombination.posedge">
<span class="sig-name descname"><span class="pre">posedge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.TriggerCombination.posedge" title="Link to this definition"></a></dt>
<dd><p>Add a low-to-high transition trigger to the list of triggers.</p>
<p>Equivalent to <a class="reference internal" href="#amaranth.sim.TriggerCombination.edge" title="amaranth.sim.TriggerCombination.edge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">edge(signal,</span> <span class="pre">1)</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim._async.TriggerCombination"><em>TriggerCombination</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="amaranth.sim.TriggerCombination.negedge">
<span class="sig-name descname"><span class="pre">negedge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#amaranth.sim.TriggerCombination.negedge" title="Link to this definition"></a></dt>
<dd><p>Add a high-to-low transition trigger to the list of triggers.</p>
<p>Equivalent to <a class="reference internal" href="#amaranth.sim.TriggerCombination.edge" title="amaranth.sim.TriggerCombination.edge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">edge(signal,</span> <span class="pre">0)</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#amaranth.sim.TriggerCombination" title="amaranth.sim._async.TriggerCombination"><em>TriggerCombination</em></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="platform.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Platform integration</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="stdlib/crc/catalog.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Algorithm catalog</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, ChipFlow
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Simulator</a><ul>
<li><a class="reference internal" href="#simulating-circuits">Simulating circuits</a><ul>
<li><a class="reference internal" href="#running-a-simulation">Running a simulation</a></li>
<li><a class="reference internal" href="#testing-synchronous-circuits">Testing synchronous circuits</a></li>
<li><a class="reference internal" href="#testing-combinational-circuits">Testing combinational circuits</a></li>
</ul>
</li>
<li><a class="reference internal" href="#replacing-circuits-with-code">Replacing circuits with code</a><ul>
<li><a class="reference internal" href="#replacing-synchronous-circuits">Replacing synchronous circuits</a></li>
<li><a class="reference internal" href="#replacing-combinational-circuits">Replacing combinational circuits</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference">Reference</a><ul>
<li><a class="reference internal" href="#amaranth.sim.Simulator"><code class="docutils literal notranslate"><span class="pre">Simulator</span></code></a><ul>
<li><a class="reference internal" href="#amaranth.sim.Simulator.add_clock"><code class="docutils literal notranslate"><span class="pre">Simulator.add_clock()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.Simulator.add_testbench"><code class="docutils literal notranslate"><span class="pre">Simulator.add_testbench()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.Simulator.add_process"><code class="docutils literal notranslate"><span class="pre">Simulator.add_process()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.Simulator.run"><code class="docutils literal notranslate"><span class="pre">Simulator.run()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.Simulator.run_until"><code class="docutils literal notranslate"><span class="pre">Simulator.run_until()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.Simulator.advance"><code class="docutils literal notranslate"><span class="pre">Simulator.advance()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.Simulator.write_vcd"><code class="docutils literal notranslate"><span class="pre">Simulator.write_vcd()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.Simulator.reset"><code class="docutils literal notranslate"><span class="pre">Simulator.reset()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#amaranth.sim.SimulatorContext"><code class="docutils literal notranslate"><span class="pre">SimulatorContext</span></code></a><ul>
<li><a class="reference internal" href="#amaranth.sim.SimulatorContext.get"><code class="docutils literal notranslate"><span class="pre">SimulatorContext.get()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.SimulatorContext.set"><code class="docutils literal notranslate"><span class="pre">SimulatorContext.set()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.SimulatorContext.critical"><code class="docutils literal notranslate"><span class="pre">SimulatorContext.critical()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.SimulatorContext.tick"><code class="docutils literal notranslate"><span class="pre">SimulatorContext.tick()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.SimulatorContext.delay"><code class="docutils literal notranslate"><span class="pre">SimulatorContext.delay()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.SimulatorContext.changed"><code class="docutils literal notranslate"><span class="pre">SimulatorContext.changed()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.SimulatorContext.edge"><code class="docutils literal notranslate"><span class="pre">SimulatorContext.edge()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.SimulatorContext.posedge"><code class="docutils literal notranslate"><span class="pre">SimulatorContext.posedge()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.SimulatorContext.negedge"><code class="docutils literal notranslate"><span class="pre">SimulatorContext.negedge()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#amaranth.sim.BrokenTrigger"><code class="docutils literal notranslate"><span class="pre">BrokenTrigger</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.DomainReset"><code class="docutils literal notranslate"><span class="pre">DomainReset</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.TickTrigger"><code class="docutils literal notranslate"><span class="pre">TickTrigger</span></code></a><ul>
<li><a class="reference internal" href="#amaranth.sim.TickTrigger.sample"><code class="docutils literal notranslate"><span class="pre">TickTrigger.sample()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.TickTrigger.until"><code class="docutils literal notranslate"><span class="pre">TickTrigger.until()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.TickTrigger.repeat"><code class="docutils literal notranslate"><span class="pre">TickTrigger.repeat()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#amaranth.sim.TriggerCombination"><code class="docutils literal notranslate"><span class="pre">TriggerCombination</span></code></a><ul>
<li><a class="reference internal" href="#amaranth.sim.TriggerCombination.sample"><code class="docutils literal notranslate"><span class="pre">TriggerCombination.sample()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.TriggerCombination.delay"><code class="docutils literal notranslate"><span class="pre">TriggerCombination.delay()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.TriggerCombination.changed"><code class="docutils literal notranslate"><span class="pre">TriggerCombination.changed()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.TriggerCombination.edge"><code class="docutils literal notranslate"><span class="pre">TriggerCombination.edge()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.TriggerCombination.posedge"><code class="docutils literal notranslate"><span class="pre">TriggerCombination.posedge()</span></code></a></li>
<li><a class="reference internal" href="#amaranth.sim.TriggerCombination.negedge"><code class="docutils literal notranslate"><span class="pre">TriggerCombination.negedge()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=1f169f65"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/platformpicker.js"></script>
    <script src="../_static/js/init.js"></script>
    </body>
</html>