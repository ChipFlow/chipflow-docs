name: Build Docs
on:
  workflow_call:

jobs:
  build-docs:
    runs-on: ubuntu-22.04

    env:
      GH_TOKEN: "${{ secrets.GITHUB_TOKEN}}"

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up PDM
        uses: pdm-project/setup-pdm@v4
        with:
          cache: true

      - name: Install deps
        run: pdm install

      - name: Build docs
        run: pdm docs

      - name: Verify AI-friendly outputs
        run: |
          echo "Checking for AI-friendly documentation outputs..."
          test -f docs/build/llms.txt && echo "✓ llms.txt found" || (echo "✗ llms.txt missing" && exit 1)
          test -f docs/build/llms-full.txt && echo "✓ llms-full.txt found" || (echo "✗ llms-full.txt missing" && exit 1)
          test -f docs/build/docs-index.json && echo "✓ docs-index.json found" || (echo "✗ docs-index.json missing" && exit 1)
          echo "All AI-friendly outputs generated successfully"

      - name: Upload docs artifact
        uses: actions/upload-artifact@v4
        with:
          name: docs
          path: docs/build

